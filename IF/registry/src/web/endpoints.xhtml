<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:jsp="http://java.sun.com/JSP/Page"
    xmlns:c="http://java.sun.com/jstl/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:t="http://myfaces.apache.org/tomahawk">
<body>

  <ui:composition template="/WEB-INF/planets/page-template.xhtml">
    <ui:param name="pagetitle" value="Register Endpoints"/>
    <ui:param name="extraCSS" value="css/registry.css" />
    
    <div id="content">
    <h:form>
		<rich:toolBar height="34" itemSeparator="line">
			<rich:toolBarGroup>
				<h:commandLink action="gotoServices">
					<h:graphicImage id="toservices" value="/images/go-jump.png" /> Services</h:commandLink>
			</rich:toolBarGroup>
			<rich:toolBarGroup location="right">
				<h:inputText id="endpointSearchInput" value="#{EndpointBean.searchStr}">
					<a4j:support event="onkeyup" reRender="endpointResults"
						requestDelay="200" />
				</h:inputText>
				<a4j:commandButton value="Search" reRender="endpointResults" />
				<a4j:status startStyleClass="statusSearching"
					stopStyleClass="statusDone" />
			</rich:toolBarGroup>
		</rich:toolBar>
		<h:panelGrid columns="2"
			columnClasses="endpointGridCol1, endpointGridCol2" width="100%">
	 	    <rich:dataTable id="endpointResults" rows="0" width="100%"
	 	    value="#{EndpointBean.endpoints}" var="endpoint" styleClass="endpointTable"
	 	    binding="#{EndpointBean.endpointsDataTable}">
	  	      <rich:column sortBy="#{endpoint.name}" sortOrder="ASCENDING"
	  	      	 styleClass="#{ ( EndpointBean.currentEndpoint.location == endpoint.location ) ? 'isCurrent' : 'isNotCurrent'}">
		  	    <f:facet name="header">Name</f:facet>
				<h:commandLink action="#{EndpointBean.selectAnEndpoint}"
						styleClass="endpointListItem">
		  	      <h:outputText value="#{endpoint.name}" styleClass="endpointItemTitle" /><br />
		  	      <h:outputText value="#{endpoint.category}"/>
				</h:commandLink>
	  	      </rich:column>
	  	  </rich:dataTable>
		  <rich:tabPanel switchType="ajax" id="endpointDetailPanel">

		    <rich:tab label="Info">
		      <c:choose>
		        <c:when test="#{EndpointBean.currentEndpoint == null}">
				  <p>There are<h:outputText value=" #{EndpointBean.endpointCount}" /> endpoints listed in the table, please choose one.</p>
				</c:when>
			    <c:otherwise>
			      <h3>Endpoint Information</h3>
                  <h:outputText value="WSDL: #{EndpointBean.currentEndpoint.location}"/><br/>
                  <h:outputText value="Status: #{EndpointBean.currentEndpoint.status}" />
				</c:otherwise>
		      </c:choose>  
        	</rich:tab>

			<rich:tab label="Description" disabled="#{EndpointBean.currentEndpoint == null or ! EndpointBean.currentEndpoint.described} ">
			  <c:choose>
			    <c:when test="#{EndpointBean.currentEndpoint.described}">
			      <h3><h:outputText value="#{EndpointBean.currentDescription.name} #{EndpointBean.currentDescription.version}"/></h3>
			      <h:outputText value="#{EndpointBean.currentDescription.description}"/><br/>
			      <h:outputText value="author->#{EndpointBean.currentDescription.author}"/><br/>
			      <h:outputText value="type->#{EndpointBean.currentDescription.type}"/><br/>
			      <h:outputText value="author->#{EndpointBean.currentDescription.author}"/><br/>
			      <h:outputText value="pub->#{EndpointBean.currentDescription.serviceProvider}"/><br/>
			      <c:if test="#{EndpointBean.currentDescription.inputFormats != null }">
	                <ul>
		            <c:forEach var="fmt" items="#{EndpointBean.currentDescription.inputFormats}">
		              <li>${fmt}</li>
		            </c:forEach>
		            </ul>
			      </c:if>
			      <c:if test="#{EndpointBean.currentDescription.paths != null}">
			        <h:outputText value="paths"/>
	                <ul>
		            <c:forEach var="path" items="#{EndpointBean.currentDescription.paths}">
		              <li>${path.inputFormat}->${path.outputFormat}</li>
		            </c:forEach>
		            </ul>
			      </c:if>
			    </c:when>
			    <c:otherwise>
			      <h:outputText value="We DON'T have a description"/>
			    </c:otherwise>
			  </c:choose>
        	</rich:tab>

			<rich:tab label="Register" disabled="#{EndpointBean.currentEndpoint == null }">
			  <c:choose>
			    <c:when test="#{EndpointBean.currentEndpoint.described}">
                  <h3><h:outputText value="Automatically Register this Service"/></h3>
                  <div>
                    <p>
                      This service implements the new Planets<h:outputText value=" #{EndpointBean.currentEndpoint.category} "/>interface.
                    </p>
                    <p>
                      It is possible to automatically register this service based on its description.
                      You can either:
                      <ul>
                        <li>Edit the service description for the
				          <h:commandLink action="#{EndpointBean.editADescription}">
		  	                <h:outputText value="#{EndpointBean.currentEndpoint.name}" />
		  	                <h:outputText value=" #{endpoint.category} service"/>
				          </h:commandLink> and register it.
				        </li>
                        <li>Register the
				          <h:commandLink action="#{EndpointBean.registerService}">
		  	                <h:outputText value="#{EndpointBean.currentEndpoint.name}" />
		  	                <h:outputText value=" #{endpoint.category} service"/>
				          </h:commandLink> automatically.
				        </li>
                      </ul>
                    </p>
                  </div>
			    </c:when>
			    <c:otherwise>
			      <h3><h:outputText value="Manually Register this Service"/></h3>
                  <div>
                    <p>This service implements the deprecated Planets
                      <h:outputText value=" #{EndpointBean.currentEndpoint.category} "/>interface.
                      This unfortunately means that the service doesn't provide enough information for the 
                      Service Registry to automatically register it.
                    </p>
                    <p>We can help a little, follow this link to create a description for this service and
                    register it.
                    </p>
                    <p>The Planets services team are currently working to move all of the IF services to the 
                    new interfaces. Going forward the old interfaces types won't be supported.  In the meantime
                    thankyou for your patience as we work to improve things.
                    </p>
                  </div>
			    </c:otherwise>
			  </c:choose>
            </rich:tab>

		 </rich:tabPanel>
  	  </h:panelGrid>
    </h:form>
    </div>
    
  </ui:composition>
</body>
</html>
