<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- $Workfile: build.xml $ ============================================
ANT build file of GenericMigrate-0-0.
Version    : $Id$
Application : PLANETS PA/4 migration services
Description: build file of GenericMigrate-0-0.
Platform   : JAVA, ANT
========================================================================
Copyright  : Swiss Federal Archives, Berne, Switzerland 
             (pending PLANETS copyright agreements)
Created    : July 07, 2009, Hartwig Thomas, Enter AG, Zurich
Sponsor    : Swiss Federal Archives, Berne, Switzerland
==================================================================== -->
<project basedir="." default="build" name="GenericMigrate-0-0">
  <property name="debuglevel" value="source,lines,vars"/>
  <property name="target" value="1.5"/>
  <property name="source" value="1.5"/>
	<property name="dirsrc" value="src"/>
	<property name="dirbin" value="bin"/>
	<property name="diretc" value="etc"/>
	<property name="dirdoc" value="doc"/>
	<property name="dirwebinf" value="webapp/WEB-INF"/>
	<property name="dirbuild" value="build"/>
	<property name="dirclasses" value="${dirbuild}/classes"/>
	<property name="dirbuildlib" value="${dirbuild}/lib"/>
	<property name="dirbuildendorsed" value="${dirbuildlib}/endorsed"/>
	<property name="dirpackages" value="packages"/>
	<property name="dirjaxws" value="../jaxws-ri"/>
	<property name="dirjaxlib" value="${dirjaxws}/lib"/>
	<property name="filejaxbapi" value="jaxb-api.jar"/>
	<property name="filejaxwsapi" value="jaxws-api.jar"/>
	<property name="filemanifest" value="META-INF/MANIFEST.MF"/>
	<property name="filewebmanifest" value="webapp/META-INF/MANIFEST.MF"/>
	<property name="filewebxml" value="web.xml"/>
	<property name="filesunjaxws" value="sun-jaxws.xml"/>
	
  <target name="init">
	  <echo message="${ant.project.name}: init"/>
    <mkdir dir="${dirdoc}"/>
    <mkdir dir="${dirclasses}"/>
    <mkdir dir="${dirbuildendorsed}"/>
    <mkdir dir="${dirpackages}"/>
  </target>

  <target name="clean">
	  <echo message="${ant.project.name}: clean"/>
    <delete dir="${dirdoc}"/>
    <delete dir="${dirbuild}"/>
    <delete dir="${dirpackages}"/>
  </target>

  <target depends="init" name="build">
    <echo message="${ant.project.name}: build"/>
    <javac debug="true" debuglevel="${debuglevel}"
    	source="${source}" 
    	target="${target}"
    	srcdir="${dirsrc}"
    	destdir="${dirclasses}"
		  includes="**/*.java"/>
		<!-- endorsed jars to lib/endorsed -->
		<copy todir="${dirbuildendorsed}">
			<fileset dir="${dirjaxlib}">
				<include name="${filejaxbapi}"/>
				<include name="${filejaxwsapi}"/>
			</fileset>
		</copy>
		<!-- jaxws-ri/lib/* -->
		<copy todir="${dirbuildlib}">
			<fileset dir="${dirjaxlib}">
				<include name="*.jar"/>
			</fileset>
		</copy>
  </target>
	
	<target depends="build" name="jar">
	  <echo message="${ant.project.name}: jar"/>
		<jar jarfile="${dirbuildlib}/${ant.project.name}.jar"
		   manifest="${filemanifest}">
  		<fileset dir="${dirclasses}">
  			<include name="**/*.class"/>
 			</fileset>
  		<fileset dir="${dirsrc}">
  			<include name="**/*.java"/>
 			</fileset>
		</jar>
	</target>
	
	<target depends="init" name="doc">
	  <echo message="${ant.project.name}: doc"/>
		<javadoc destdir="${dirdoc}" windowtitle="PLANETS Services Documentation">
			<package name="eu.planets_project.services.*"/>
			<sourcepath location="${dirsrc}"/>
			<bottom>
				<![CDATA[PLANETS Project, Preservation Action]]>
			</bottom>
		</javadoc>
	</target>
	
	<target depends="jar,doc" name="zip">
	  <echo message="${ant.project.name}: zip"/>
		<zip zipfile="${dirpackages}/${ant.project.name}.zip">
			<!-- bin/publish bin/client -->
			<zipfileset dir="." prefix="${ant.project.name}">
				<include name="${dirbin}/**/*.cmd"/>
			</zipfileset>
			<!-- doc/* -->
			<zipfileset dir="." prefix="${ant.project.name}">
				<include name="${dirdoc}/**/*"/>
			</zipfileset>
			<!-- etc/* -->
			<zipfileset dir="." prefix="${ant.project.name}">
				<include name="${diretc}/**/*"/>
			</zipfileset>
			<!-- lib/GenericMigrate-0-0.jar, lib/JAXWS JARs incl. endorsed -->
			<zipfileset dir="${dirbuild}" prefix="${ant.project.name}">
				<include name="**/*.jar"/>
			</zipfileset>
			<!-- readme.txt etc. -->
			<zipfileset dir="." prefix="${ant.project.name}">
				<include name="*.txt"/>
		  </zipfileset>
	  </zip>
	</target>
	
	<target depends="jar" name="war">
	  <echo message="${ant.project.name}: war"/>
		<war warfile="${dirpackages}/${ant.project.name}.war"
			  manifest="${filewebmanifest}"
			  webxml="${dirwebinf}/${filewebxml}">
			<lib dir="${dirbuildlib}" includes="${ant.project.name}.jar"/>
			<webinf dir="${dirwebinf}">
			  <include name="${filesunjaxws}"/>
			</webinf>
	  </war>
	</target>
	
	<target depends="war,zip" name="packages"/>
	
</project>
