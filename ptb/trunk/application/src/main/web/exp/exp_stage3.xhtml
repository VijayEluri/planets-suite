<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
    xmlns:t="http://myfaces.apache.org/tomahawk"
    xmlns:c="http://java.sun.com/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">
<body>
<ui:composition template="/WEB-INF/templates/main_template.xhtml">
	<ui:define name="title">
        #{res.title} - #{ExperimentBean.ename}: #{res['exp_stage3.pageTitle']}
  </ui:define>

	<ui:define name="header">
		<ui:include src="/WEB-INF/templates/header.xhtml">
			<ui:param name="page" value="new_exp" />
		</ui:include>
		<script type="text/javascript"
			src="${facesContext.externalContext.requestContextPath}/js/overlib/overlib.js"></script>
	</ui:define>

	<ui:define name="content" rendered="#{ExperimentBean != null}">
		<div id="mainwrapper">
			<div id="maincol">
				<div class="innertubemain">        
<h:form>
      <table id="expHeaderTable"><tr>
      <td class="headerText">
      <h2><h:outputText value="#{res['new_exp.stage3']}"/></h2>
      </td>
      <td class="headerButtons">
        <h:commandButton value="#{res['exp_stage3.saveSubmit']}" 
              action="#{NewExp_Controller.commandSaveExperimentAndSubmit}" disabled="#{ExperimentBean.approved}"/>
        <h:commandButton value="#{res['button.save']}"
                                    action="#{NewExp_Controller.commandSaveExperiment}"
                                    disabled="#{ExperimentBean.approved}" />
      </td>
      </tr>
      </table>
</h:form>

<rich:simpleTogglePanel label="#{res['exp_stage3.automaticProps']}" opened="true" switchType="server">
<p>These are properties that the Testbed can automatically measure during your experiment.</p>

<h:form>
        <rich:dataTable value="#{NewExp_Controller.observables}" var="prop" rows="25" 
        reRender="prop_ds" styleClass="tbTable" binding="#{NewExp_Controller.obsTable}">
        <!-- 
            <f:facet name="header">
                <h:outputText value="Observable Properties"/>
            </f:facet>
         -->
            
            <rich:column sortBy="#{prop.stage}" sortOrder="DESCENDING"> 
                <f:facet name="header">
                    <h:outputText value="Experiment Stage"/>
                </f:facet>
                <h:outputText value="#{prop.stage}"/>
            </rich:column>
            
            <rich:column> 
                <f:facet name="header">
                    <h:outputText value="Measure"/>
                </f:facet>
                <h:selectBooleanCheckbox value="#{prop.selected}"  readonly="#{ExperimentBean.approved}" valueChangeListener="#{NewExp_Controller.handleObsSelectChangeListener}"/>
            </rich:column>
            
            <rich:column sortBy="#{prop.type}">
                <f:facet name="header">
                    <h:outputText value="Type"/>
                </f:facet>
                <h:outputText value="#{prop.type}"/> 
            </rich:column>
            
            <rich:column sortBy="#{prop.name}">
                <f:facet name="header">
                    <h:outputText value="Name"/>
                </f:facet>
                <t:graphicImage value="/graphics/help.gif" style="float: right; padding: 1px 5px;"/>
                <h:outputText value="#{prop.name}"/>
                <rich:toolTip>
                  <h:outputText value="#{prop.description}"/>
                  <h:outputText value=" (#{prop.identifier})" rendered="#{prop.identifier != null}"/>
                </rich:toolTip>
            </rich:column>
            
            <rich:column sortBy="#{prop.unit}">
                <f:facet name="header">
                    <h:outputText value="Unit"/>
                </f:facet>
                <h:outputText value="#{prop.unit}"/> 
            </rich:column>
            
            <f:facet name="footer">
                <rich:datascroller id="prop_ds"></rich:datascroller>
            </f:facet>
        </rich:dataTable>

        <p>        
        <h:commandButton value="#{res['button.save']}"
                                    action="#{NewExp_Controller.commandSaveExperiment}"
                                    disabled="#{ExperimentBean.approved}" />
        </p>
        <p>
         <h:commandButton value="#{res['exp_stage3.saveSubmit']}" 
              action="#{NewExp_Controller.commandSaveExperimentAndSubmit}" disabled="#{ExperimentBean.approved}"/>
       </p>
    </h:form>

</rich:simpleTogglePanel>


<rich:simpleTogglePanel label="#{res['exp_stage3.optionalManualBMGs']}" opened="false" switchType="server">
    
<p>These are properties that the Testbed <b>cannot</b> automatically measure during your experiment, and so must be measured manually instead.</p>

    <h:form id="stage3form">

    <h:messages for="stage3form" errorClass="errorMessage" infoClass="infoMessage"/>

<h:panelGroup rendered="#{ExperimentBean.dtype != ''}">

						<fieldset>
							<legend>#{res['exp_stage3.legendOutcomes']}</legend>
              
							<p>Here you can specify the Benchmark Goals for your experiment.  These will be used during the evaluation of your experiment to provide a record of the goals of your experiment and whether these goals were achieved.</p>	

<p>
<h:outputLabel value="#{res['new_exp.expDigiType']}" for="dtype" ><span style="color:red;font-weight:bold;"> *</span></h:outputLabel>
<h:selectManyListbox id="dtype" readonly="#{ExperimentBean.approved}" disabled="#{ExperimentBean.approved}"
  value="#{ExperimentBean.dtype}" style="width: 23em;" onchange="submit();">
   <f:selectItems
    value="#{ExperimentBean.dtypeList}"/>
</h:selectManyListbox> <img src="${facesContext.externalContext.requestContextPath}/graphics/help.gif" alt="" title="" onmouseover="return overlib('&lt;p style=\'width:121px;text-align:left;\'&gt;#{res['new_exp.tooltipObjectType']}&lt;/p&gt;', OFFSETX, 20, OFFSETY, -20, WIDTH, 130);" onmouseout="return nd();" />
</p>
<div class="clear"></div>

                    <!-- puts a list of all available Experiment 'BenchmarkBeans' into the session map -->
                    #{NewExp_Controller.retrieveBenchmarkBeans}      
              
							<p>Highlight benchmark goals in category: 
							<h:selectOneMenu id="filterBMCategory" value="#{ExperimentBean.BMGoalCategoryFilterValue}" immediate="true" 
             					valueChangeListener="#{NewExp_Controller.processBMGoalCategoryFilterChange}">
                 				<f:selectItems value="#{ExperimentBean.allBMGoalCategoriesForFilter}" />                        
        						<a4j:support event="onchange" reRender="dataTable" />
        					</h:selectOneMenu>	  
        					</p>   
						  	<h:dataTable id="dataTable" var="bm" value="#{BenchmarkBeans}"			    	              
			        	          rowId="#{bm.ID}"
			            	      cellpadding="2"
			                	  cellspacing="0"
				                  border="1">
							        <h:column>
									    <h:selectBooleanCheckbox id="selected" value="#{bm.selected}"  readonly="#{ExperimentBean.approved}"  disabled="#{ExperimentBean.approved}" valueChangeListener="#{NewExp_Controller.processSelBMValueTicked}">	
									    	<f:param name="bmGoalID" value="#{bm.ID}"/>
									    	<a4j:support event="onchange"/>	
									    </h:selectBooleanCheckbox>	            	
						            </h:column>
							        <h:column>
			            				<f:facet name="header">#{res['exp_stage3.bgCriteria']}: #{ExperimentBean.BGExperimentText}</f:facet>
										<h:outputText value="#{bm.name}" rendered="#{ExperimentBean.BMGoalCategoryFilterValue == bm.category}" style="background-color:#FFF8C6; font-weight:bold;"/>
						            	<h:outputText value="#{bm.name}" rendered="#{ExperimentBean.BMGoalCategoryFilterValue != bm.category}"/>
						        	</h:column>
							        <h:column>
			            				<f:facet name="header">#{res['exp_stage3.bgExplanation']}</f:facet>
						            	#{bm.definition}<br/>
						            	<i>#{bm.description}</i>
						        	</h:column>	
							</h:dataTable>
							
						</fieldset>
</h:panelGroup>

          
							<p>
					            <h:commandButton value="#{res['button.save']}"  
					            action="#{NewExp_Controller.updateBenchmarksAction}"  readonly="#{ExperimentBean.approved}" disabled="#{ExperimentBean.approved}"/>		
							</p>
							<p>
					            <h:commandButton value="#{res['exp_stage3.saveSubmit']}" 
					            action="#{NewExp_Controller.updateBenchmarksAndSubmitAction}" disabled="#{ExperimentBean.approved}"/>										
							</p>
							<p><b>#{res['exp_stage3.warning']}</b></p>
					</h:form>

</rich:simpleTogglePanel>

            <p>&#160;</p>
        <p>&#160;</p>

        <p>&#160;</p>
        <p>&#160;</p>
        <p>&#160;</p>
        <p>&#160;</p>
        <p>&#160;</p>
        <p>&#160;</p>
        <p>&#160;</p>
        <p>&#160;</p>

            
    <ui:include src="/WEB-INF/templates/comment_template.xhtml">
       <ui:param name="ExperimentBean" value="#{ExperimentBean}" />
       <ui:param name="ExperimentPhase" value="3" />
    </ui:include>
                
				</div>
			</div>
		</div>

		<div id="leftcol">

        <!-- Include the standard experiment builder sidebar. -->
        <ui:include src="/WEB-INF/templates/exp_sidebar.xhtml">
           <ui:param name="ExperimentBean" value="#{ExperimentBean}" />
           <ui:param name="ExperimentPhase" value="3" />
        </ui:include>
        
		</div>

	</ui:define>
	<ui:define name="footer">
		<ui:include src="/WEB-INF/templates/footer.xhtml" />
	</ui:define>
</ui:composition>

</body>
</html>
