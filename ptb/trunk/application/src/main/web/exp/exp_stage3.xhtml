<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
    xmlns:t="http://myfaces.apache.org/tomahawk"
    xmlns:c="http://java.sun.com/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">
<body>
<ui:composition template="/WEB-INF/templates/main_template.xhtml">
	<ui:define name="title">
        #{res.title} - #{ExperimentBean.ename}: #{res['exp_stage3.pageTitle']}
  </ui:define>

	<ui:define name="header">
		<ui:include src="/WEB-INF/templates/header.xhtml">
			<ui:param name="page" value="new_exp" />
		</ui:include>
		<script type="text/javascript"
			src="${facesContext.externalContext.requestContextPath}/js/overlib/overlib.js"></script>
	</ui:define>

	<ui:define name="content" rendered="#{ExperimentBean != null}">
		<div id="mainwrapper">
			<div id="maincol">
				<div class="innertubemain">
				  <h:form id="stage3form">
				    <!-- puts a list of all available 'BenchmarkBeans' into the session map -->
					#{NewExp_Controller.retrieveBenchmarkBeans}
      
					<p>Supply information about the estimated resources your experiment will require and the objectives you expect your experiment to meet.</p>
						<h:messages for="stage3form" errorClass="errorMessage" infoClass="infoMessage"/>
						<fieldset>
							<legend>#{res['exp_stage3.legendOutcomes']}</legend>
							<p>Here you can specify the Benchmark Goals for your experiment.  These will be used during the evaluation of your experiment to provide a record of the goals of your experiment and whether these goals were achieved.</p>	
							<p>Highlight benchmark goals in category: 
							<h:selectOneMenu id="filterBMCategory" value="#{ExperimentBean.BMGoalCategoryFilterValue}" immediate="true" 
             					valueChangeListener="#{NewExp_Controller.processBMGoalCategoryFilterChange}">
                 				<f:selectItems value="#{ExperimentBean.allBMGoalCategoriesForFilter}" />                        
        						<a4j:support event="onchange" reRender="dataTable" />
        					</h:selectOneMenu>	  
        					</p>   
						  	<h:dataTable id="dataTable" var="bm" value="#{BenchmarkBeans}"			    	              
			        	          rowId="#{bm.ID}"
			            	      cellpadding="2"
			                	  cellspacing="0"
				                  border="1">
							        <h:column>
									    <h:selectBooleanCheckbox id="selected" value="#{bm.selected}"  readonly="#{ExperimentBean.approved}"  disabled="#{ExperimentBean.approved}" valueChangeListener="#{NewExp_Controller.processSelBMValueTicked}">	
									    	<f:param name="bmGoalID" value="#{bm.ID}"/>
									    	<a4j:support event="onchange"/>	
									    </h:selectBooleanCheckbox>	            	
						            </h:column>
							        <h:column>
			            				<f:facet name="header">#{res['exp_stage3.bgCriteria']}: #{ExperimentBean.BGExperimentText}</f:facet>
										<h:outputText value="#{bm.name}" rendered="#{ExperimentBean.BMGoalCategoryFilterValue == bm.category}" style="background-color:#FFF8C6; font-weight:bold;"/>
						            	<h:outputText value="#{bm.name}" rendered="#{ExperimentBean.BMGoalCategoryFilterValue != bm.category}"/>
						        	</h:column>
							        <h:column>
			            				<f:facet name="header">#{res['exp_stage3.bgExplanation']}</f:facet>
						            	#{bm.definition}<br/>
						            	<i>#{bm.description}</i>
						        	</h:column>	
						        	<h:column>
						        		<f:facet name="header">#{res['exp_stage3.useAutoEvalSerivce']}</f:facet>
						        		<h:panelGroup rendered="#{bm.autoEvalServiceAvailable}">
						        		<!-- h:selectBooleanCheckbox id="useEvalService" value="true" label="use auto-evaluation" readonly="#{ExperimentBean.approved}"  disabled="#{ExperimentBean.approved}">	
									    	<f:param name="bmGoalID" value="#{bm.ID}"/>
									    	<a4j:support event="onchange"/>	
									    </h:selectBooleanCheckbox-->	 
										<a4j:commandLink action="#{NewExp_Controller.command_configureAutoEvalService}">
                							<h:outputText value="configure" /> 
                							<f:param value="#{bm.ID}" name="configBMGoalID"/>
            							</a4j:commandLink>
            							</h:panelGroup>
						        	</h:column>     	
							</h:dataTable>
							
						</fieldset>
							<p>
					            <h:commandButton value="#{res['button.save']}"  
					            action="#{NewExp_Controller.updateBenchmarksAction}"  readonly="#{ExperimentBean.approved}" disabled="#{ExperimentBean.approved}"/>		
							</p>
							<p>
					            <h:commandButton value="#{res['exp_stage3.saveSubmit']}" 
					            action="#{NewExp_Controller.updateBenchmarksAndSubmitAction}" disabled="#{ExperimentBean.approved}"/>										
							</p>
							<p><b>#{res['exp_stage3.warning']}</b></p>		
					</h:form>
            
    <ui:include src="/WEB-INF/templates/comment_template.xhtml">
       <ui:param name="ExperimentBean" value="#{ExperimentBean}" />
       <ui:param name="ExperimentPhase" value="3" />
    </ui:include>
            
				</div>
			</div>
		</div>

		<div id="leftcol">

		<h3 class="leftcol">#{res['new_exp.progress']}</h3>
		<div class="innertube">
			<ul class="exp"><h:form>
				<h:panelGroup rendered="#{ExperimentBean.currentStage > 1}">
					<li class="exp"><h:commandLink action="goToStage1"
								styleClass="exp_done">
							<t:outputText value="#{res['new_exp.stage1']}" />
					</h:commandLink></li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage lt 1}">
					<li class="exp_nd">#{res['new_exp.stage1']}</li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage == 1}">
					<li class="exp_sel"><h:commandLink action="goToStage1" styleClass="exp">
					<t:outputText value="#{res['new_exp.stage1']}" />
					</h:commandLink></li>
				</h:panelGroup>
				
				<h:panelGroup rendered="#{ExperimentBean.currentStage > 2}">
					<li class="exp"><h:commandLink action="goToStage2"
								styleClass="exp_done">
							<t:outputText value="#{res['new_exp.stage2']}" />
					</h:commandLink></li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage lt 2}">
					<li class="exp_nd">#{res['new_exp.stage2']}</li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage == 2}">
					<li class="exp_sel"><h:commandLink action="goToStage2" styleClass="exp">
					<t:outputText value="#{res['new_exp.stage2']}" />
					</h:commandLink></li>
				</h:panelGroup>
				
				<h:panelGroup rendered="#{ExperimentBean.currentStage > 3}">
					<li class="exp"><h:commandLink action="goToStage3"
								styleClass="exp_done">
							<t:outputText value="#{res['new_exp.stage3']}" />
					</h:commandLink></li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage lt 3}">
					<li class="exp_nd">#{res['new_exp.stage3']}</li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage ==3}">
					<li class="exp_sel"><h:commandLink action="goToStage3" styleClass="exp">
					<t:outputText value="#{res['new_exp.stage3']}" />
					</h:commandLink></li>
				</h:panelGroup>
				
				<h:panelGroup rendered="#{ExperimentBean.currentStage > 4}">
					<li class="exp"><h:commandLink action="goToStage4"
								styleClass="exp_done">
							<t:outputText value="#{res['new_exp.stage4']}" />
					</h:commandLink></li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage lt 4}">
					<li class="exp_nd">#{res['new_exp.stage4']}</li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage == 4}">
					<li class="exp_sel"><h:commandLink action="goToStage4" styleClass="exp">
					<t:outputText value="#{res['new_exp.stage4']}" />
					</h:commandLink></li>
				</h:panelGroup>
				
				<h:panelGroup rendered="#{ExperimentBean.currentStage > 5}">
					<li class="exp"><h:commandLink action="goToStage5"
								styleClass="exp_done">
							<t:outputText value="#{res['new_exp.stage5']}" />
					</h:commandLink></li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage lt 5}">
					<li class="exp_nd">#{res['new_exp.stage5']}</li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage == 5}">
					<li class="exp_sel"><h:commandLink action="goToStage5" styleClass="exp">
					<t:outputText value="#{res['new_exp.stage5']}" />
					</h:commandLink></li>
				</h:panelGroup>
				
				<h:panelGroup rendered="#{ExperimentBean.currentStage > 6}">
					<li class="exp"><h:commandLink action="goToStage6"
								styleClass="exp_done">
							<t:outputText value="#{res['new_exp.stage6']}" />
					</h:commandLink></li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage lt 6}">
					<li class="exp_nd">#{res['new_exp.stage6']}</li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage == 6}">
					<li class="exp_sel"><h:commandLink action="goToStage6" styleClass="exp">
					<t:outputText value="#{res['new_exp.stage6']}" />
					</h:commandLink></li>
				</h:panelGroup>
				</h:form>
			</ul>			
		</div>
		</div>

	</ui:define>
	<ui:define name="footer">
		<ui:include src="/WEB-INF/templates/footer.xhtml" />
	</ui:define>
</ui:composition>

</body>
</html>
