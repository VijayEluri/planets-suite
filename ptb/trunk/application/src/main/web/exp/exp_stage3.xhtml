<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
    xmlns:t="http://myfaces.apache.org/tomahawk"
    xmlns:c="http://java.sun.com/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">
<body>
<ui:composition template="/WEB-INF/templates/main_template.xhtml">
	<ui:define name="title">
        #{res.title} - #{ExperimentBean.ename}: #{res['exp_stage3.pageTitle']}
  </ui:define>

	<ui:define name="header">
		<ui:include src="/WEB-INF/templates/header.xhtml">
			<ui:param name="page" value="new_exp" />
		</ui:include>
		<script type="text/javascript"
			src="${facesContext.externalContext.requestContextPath}/js/overlib/overlib.js"></script>
	</ui:define>

	<ui:define name="content" rendered="#{ExperimentBean != null}">
		<div id="mainwrapper">
			<div id="maincol">
				<div class="innertubemain">        
<a4j:form>

    <ui:include src="/WEB-INF/templates/exp_page_bands.xhtml">
       <ui:param name="ExperimentPhase" value="3" />
       <ui:param name="PlaceBandAsHeader" value="true" />
    </ui:include>

      <ui:include src="/WEB-INF/templates/global_error_box.xhtml"/>

<a4j:region renderRegionOnly="true">
<rich:simpleTogglePanel label="#{res['exp_stage3.automaticProps']}" opened="true" switchType="ajax">
<p>These are properties that the Testbed can automatically measure during your experiment.</p>

<h:panelGrid columns="2" styleClass="expDesignerPanel" columnClasses="doListColumn,expDesignColumn">
    <rich:panel styleClass="expExecLogPanel">
        <rich:dataTable value="#{NewExp_Controller.stages}" var="stage" styleClass="tbTable">
            <rich:column> 
                <f:facet name="header">
                    <h:outputText value="Experiment Stage"/>
                </f:facet>
                <h:commandLink>
          			<f:actionListener type="eu.planets_project.tb.gui.backing.exp.SelectStageActionListener"/>
                	<h:outputText value="#{stage.name}" styleClass="#{ ( ExperimentBean.selectedStage.name eq stage.name ) ? 'isSelected' : 'isNotSelected'}" />
                </h:commandLink>
            </rich:column>
        </rich:dataTable>
         
        <h:panelGroup rendered="#{ExperimentBean.selectedStage == null}">
          Select an experiment stage to view.
        </h:panelGroup>
        <h:panelGroup rendered="#{ExperimentBean.selectedStage != null}">
        <p>
        Stage: #{ExperimentBean.selectedStage.name}
        </p>
        <p>
        #{ExperimentBean.selectedStage.description}
        </p>
        </h:panelGroup>
        
    </rich:panel>

    <rich:panel styleClass="expMeasurementPanel">
        <rich:dataTable value="#{NewExp_Controller.observables}" var="prop" rows="50" 
        reRender="prop_ds" styleClass="tbTable" binding="#{NewExp_Controller.obsTable}">
        <!-- 
            <f:facet name="header">
                <h:outputText value="Observable Properties"/>
            </f:facet>
         -->
            
            <rich:column> 
                <f:facet name="header">
                    <h:outputText value="Measure"/>
                </f:facet>
                <h:selectBooleanCheckbox value="#{prop.selected}"  disabled="#{ExperimentBean.approved || true}" valueChangeListener="#{NewExp_Controller.handleObsSelectChangeListener}"/>
            </rich:column>
            
            <rich:column sortBy="#{prop.type}">
                <f:facet name="header">
                    <h:outputText value="Type"/>
                </f:facet>
                <h:outputText value="#{prop.type}"/> 
            </rich:column>
            
            <rich:column sortBy="#{prop.name}" sortOrder="DESCENDING">
                <f:facet name="header">
                    <h:outputText value="Name"/>
                </f:facet>
                <t:graphicImage value="/graphics/help.gif" style="float: right; padding: 1px 5px;"/>
                <h:outputText value="#{prop.name}"/>
                <rich:toolTip showDelay="500">
                  <h:outputText value="#{prop.description}"/>
                  <h:panelGroup rendered="#{prop.identifier != null}">
                    <br/><i><h:outputText value="(URI: #{prop.identifier})"/></i>
                  </h:panelGroup>
                </rich:toolTip>
            </rich:column>
            
            <rich:column sortBy="#{prop.unit}">
                <f:facet name="header">
                    <h:outputText value="Unit"/>
                </f:facet>
                <h:outputText value="#{prop.unit}"/> 
            </rich:column>
            
            <f:facet name="footer">
                <rich:datascroller id="prop_ds" renderIfSinglePage="false"></rich:datascroller>
            </f:facet>
        </rich:dataTable>
        
    </rich:panel>
</h:panelGrid>

</rich:simpleTogglePanel>
</a4j:region>

<!-- includes the ontology browser -->
<a4j:region renderRegionOnly="true">
<rich:simpleTogglePanel id="ontologytree" label="#{res['exp_stage3.ontologyProps']}" opened="true" switchType="ajax">  
	<p>These are properties that the Testbed <b>cannot</b> automatically measure during your experiment, and so must be measured manually instead.</p>
    <ui:include src="/WEB-INF/templates/property_tree_browser.xhtml">
       <ui:param name="Standalone" value="false" />
       <ui:param name="experimentStages" value="#{NewExp_Controller.stages}" />
       <ui:param name="expApproved" value="#{ExperimentBean.approved}"/>
    </ui:include>

</rich:simpleTogglePanel>
</a4j:region>

    <ui:include src="/WEB-INF/templates/exp_page_bands.xhtml">
       <ui:param name="ExperimentPhase" value="3" />
       <ui:param name="PlaceBandAsHeader" value="false" />
    </ui:include>

</a4j:form>

    <ui:include src="/WEB-INF/templates/comment_template.xhtml">
       <ui:param name="ExperimentBean" value="#{ExperimentBean}" />
       <ui:param name="ExperimentPhase" value="3" />
    </ui:include>
                
        <p>&#160;</p>
        <p>&#160;</p>
        <p>&#160;</p>
        <p>&#160;</p>
        <p>&#160;</p>
        <p>&#160;</p>
        <p>&#160;</p>
        <p>&#160;</p>
        <p>&#160;</p>
        <p>&#160;</p>

            
				</div>
			</div>
		</div>

		<div id="leftcol">

        <!-- Include the standard experiment builder sidebar. -->
        <ui:include src="/WEB-INF/templates/exp_sidebar.xhtml">
           <ui:param name="ExperimentBean" value="#{ExperimentBean}" />
           <ui:param name="ExperimentPhase" value="3" />
        </ui:include>
        
		</div>

	</ui:define>
	<ui:define name="footer">
		<ui:include src="/WEB-INF/templates/footer.xhtml" />
	</ui:define>
</ui:composition>

</body>
</html>
