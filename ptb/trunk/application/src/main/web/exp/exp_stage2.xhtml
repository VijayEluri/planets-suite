<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:t="http://myfaces.apache.org/tomahawk"
    xmlns:c="http://java.sun.com/jstl/core">
<body>
<ui:composition template="/WEB-INF/templates/main_template.xhtml">
	<ui:define name="title">
        #{res.title} - <h:outputText value="#{ExperimentBean.ename}"/> : #{res['exp_stage2.pageTitle']}
  </ui:define>

	<ui:define name="header">
		<ui:include src="/WEB-INF/templates/header.xhtml">
			<ui:param name="page" value="new_exp" />
		</ui:include>
		<script type="text/javascript"
			src="${facesContext.externalContext.requestContextPath}/js/overlib/overlib.js"></script>
		<script type="text/javascript">
			var valid_extensions = /(.jpg|.jpeg|.gif)$/i;

			function checkExtension(fld) {
			    if (valid_extensions.test(fld.value)) return true;
			    alert('The selected file is of the wrong type.');
			    fld.select();
			    fld.focus();
			    return false;
			}
		</script>			
	</ui:define>

	<ui:define name="content">
		<div id="mainwrapper">
		<div id="maincol">
		<div class="innertubemain">
			<h:form id="selectExpTypeForm">
				<fieldset>
					<legend>#{res['exp_stage2.legendOne']}</legend>
					<p>Your choice of experiment type will affect the tools and data
					that will be made available.<br />
					You may return to this page to choose a difference experiment type at
					any point until you submit your experiment for execution.</p>
					<p>
						<h:selectOneMenu onchange="this.form.submit()" 
						value="#{ExperimentBean.etype}"
						valueChangeListener="#{Manager_Backing.changedExpTypeEvent}"
						immediate="true"  readonly="#{ExperimentBean.approved}" disabled="#{ExperimentBean.approved}">
							<f:selectItems value="#{Manager_Backing.availableExperimentTypes}" />
						</h:selectOneMenu>
						<h:commandButton value="#{res['button.go']}"
						action="#{Manager_Backing.changedExpType}"  readonly="#{ExperimentBean.approved}" disabled="#{ExperimentBean.approved}" />
					</p>
				</fieldset>
			</h:form>
			<h:form id="selectWorkflowForm" rendered="#{not empty ExperimentBean.etype}">
				<fieldset>
					<legend>#{res['exp_stage2.legendTwo']}</legend>
					<h:selectOneMenu
					onchange="this.form.submit()"
					value="#{ExperimentBean.workflowTypeId}"
					valueChangeListener="#{Manager_Backing.changedExpWorkflowEvent}"
					immediate="true"  readonly="#{ExperimentBean.approved}" disabled="#{ExperimentBean.approved}">
						<f:selectItems value="#{Manager_Backing.availableWorkflows}" />
					</h:selectOneMenu>
					<h:commandButton value="#{res['button.go']}"
					action="#{Manager_Backing.changedExpWorkflow}"  readonly="#{ExperimentBean.approved}" disabled="#{ExperimentBean.approved}" />
				</fieldset>
			</h:form>
			<h:form id="configureExpWorkflowForm" enctype="multipart/form-data" rendered="#{not empty Workflow}">
				<fieldset>

					<legend>#{res['exp_stage2.legendThree']}</legend>
					<b>#{res['exp_stage2.workflowName']} </b>#{Workflow.name}<br/>
					<b>#{res['exp_stage2.workflowTool']} </b>#{Workflow.toolType}<br/>
					<b>#{res['exp_stage2.outputMime']} </b> <br/>
					<ul>
						<c:forEach var="mtype" items="#{Workflow.requiredOutputMIMETypes}">
						  <li>#{mtype}</li>
						</c:forEach>
					</ul>					
					<br/>	
					<b>#{res['exp_stage2.workflowServices']} </b> <br/>
					<ul>
					<c:forEach var="svc" items="#{Workflow.workflowServices}">
						  <li>#{res['exp_stage2.serviceName']} #{svc.serviceName}</li>
						  <li>#{res['exp_stage2.WSDL']} #{svc.WSDL}</li><br/>
					</c:forEach>
					</ul>
                                    <p>
                                        <b>#{res['exp_stage2.inputMime']} </b> <br/>
                                        <ul>
                                            <c:forEach var="mtype" items="#{Workflow.requiredInputMIMETypes}">
                                                <li>#{mtype}</li>
                                            </c:forEach>
                                        </ul>					
                                        <t:inputFileUpload id="fileupload" rendered="#{empty ExperimentBean.eworkflowInputData}"
                                             accept="#{Workflow.requiredInputMIMETypes[0]}"
                                             value="#{FileUploadBean.upFile}"
                                             storage="file"
                                             styleClass="fileUploadInput"
                                             required="true"
                                             maxlength="10000000"  
                                             readonly="#{ExperimentBean.approved}" 
                                             disabled="#{ExperimentBean.approved}"/><br/>
										<h:message for="fileupload"/>
                                        <h:panelGroup rendered="#{not empty ExperimentBean.eworkflowInputData}">
                                            <h:outputText value="#{res['exp_stage2.inputData']} "/>
                                            <h:outputText value="#{ExperimentBean.eworkflowInputData}" style="font-style: italic;font-weight: bold;"/>
                                            <h:commandButton value="#{res['button.change']}"
                   action="#{Manager_Backing.changeExpWorkflowDataAction}"  readonly="#{ExperimentBean.approved}" disabled="#{ExperimentBean.approved}" />
                                        </h:panelGroup>                               
                                        <br/>
                                        <h:commandButton value="#{res['button.save']}"
                      action="#{Manager_Backing.saveExpWorkflowAction}" />
                                    </p>
				</fieldset>
			</h:form>

		<p>&#160;</p>
		<p>&#160;</p>

		<p>&#160;</p>
		<p>&#160;</p>
		<p>&#160;</p>
		<p>&#160;</p>
		<p>&#160;</p>
		<p>&#160;</p>
		<p>&#160;</p>
		<p>&#160;</p>



		</div>
		</div>
		</div>


		<div id="leftcol">

		<h3 class="leftcol">#{res['new_exp.progress']}</h3>
		<div class="innertube">
			<ul class="exp"><h:form>
				<li class="exp"><h:commandLink action="goToStage1"
							styleClass="exp_done">
						<t:outputText value="#{res['new_exp.stage1']}" />
				</h:commandLink></li>
				<h:panelGroup rendered="#{ExperimentBean.currentStage lt 2 || ExperimentBean.currentStage == 2}">
                                    <li class="exp_sel"><a href="#" class="exp">#{res['new_exp.stage2']}</a></li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage > 2}">
					<li class="exp_sel"><a href="#" class="exp_done">#{res['new_exp.stage2']}</a></li>
				</h:panelGroup>	
				<h:panelGroup rendered="#{ExperimentBean.currentStage >= 3}">
					<li class="exp"><h:commandLink action="goToStage3"
								styleClass="exp_done">
							<t:outputText value="#{res['new_exp.stage3']}" />
					</h:commandLink></li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage lt 3}">
					<li class="exp_nd">#{res['new_exp.stage3']}</li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage >= 4}">
					<li class="exp"><h:commandLink action="goToStage4"
								styleClass="exp_done">
							<t:outputText value="#{res['new_exp.stage4']}" />
					</h:commandLink></li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage lt 4}">
					<li class="exp_nd">#{res['new_exp.stage4']}</li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage >= 5}">
					<li class="exp"><h:commandLink action="goToStage5"
								styleClass="exp_done">
							<t:outputText value="#{res['new_exp.stage5']}" />
					</h:commandLink></li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage lt 5}">
					<li class="exp_nd">#{res['new_exp.stage5']}</li>
				</h:panelGroup>		
				<h:panelGroup rendered="#{ExperimentBean.currentStage >= 6}">
					<li class="exp"><h:commandLink action="goToStage6"
								styleClass="exp_done">
							<t:outputText value="#{res['new_exp.stage6']}" />
					</h:commandLink></li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage lt 6}">
					<li class="exp_nd">#{res['new_exp.stage6']}</li>
				</h:panelGroup>	
				</h:form>
			</ul>
		</div>
		</div>

	</ui:define>
	<ui:define name="footer">
		<ui:include src="/WEB-INF/templates/footer.xhtml" />
	</ui:define>
</ui:composition>

</body>
</html>
