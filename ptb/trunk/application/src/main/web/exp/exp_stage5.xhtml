<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:t="http://myfaces.apache.org/tomahawk"
    xmlns:c="http://java.sun.com/jstl/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich">
<body>
<ui:composition template="/WEB-INF/templates/main_template.xhtml">
	<ui:define name="title">
        #{res.title} - #{ExperimentBean.ename}: #{res['exp_stage5.pageTitle']}
  </ui:define>

	<ui:define name="header">
		<ui:include src="/WEB-INF/templates/header.xhtml">
			<ui:param name="page" value="new_exp" />
		</ui:include>
	</ui:define>

	<ui:define name="content" rendered="#{ExperimentBean != null}">
		<div id="mainwrapper">
		<div id="maincol">
		<div class="innertubemain">

<h:form>    
      <table id="expHeaderTable"><tr>
      <td class="headerText">
      <h2><h:outputText value="#{res['new_exp.stage5']}"/></h2>
      </td>
      <td class="headerButtons">
      </td>
      </tr>
      </table>
</h:form>
      
<a4j:form id="runExperimentForm">

	<h:panelGroup rendered="#{ExperimentBean.currentStage==5}">
                   <h:panelGroup rendered="#{((not NewExp_Controller.experimentExecutable.executionRunning) and (not NewExp_Controller.experimentExecutable.executionCompleted))}">
                        <p>Your experiment has been setup and approved successfully - you may now <b>run the experiment</b>: </p>
                <a4j:commandButton id="executeExperimentButton" value="#{res['exp_stage5.button.run']}" 
                action="#{NewExp_Controller.executeExperiment}" disabled="#{NewExp_Controller.experimentExecutable.executionRunning}">
                    <a4j:support event="onclick" reRender="runExperimentForm" />
                </a4j:commandButton>                        
                    </h:panelGroup>
                   <h:panelGroup rendered="#{((not NewExp_Controller.experimentExecutable.executionRunning) and (not NewExp_Controller.experimentExecutable.executionCompleted))}">
                        <p><br/><br/>If you have made an error, and wish to make further alterations before running your experiment, you can go back to the editing stage:</p>
                        <h:commandButton value="#{res['button.edit']}"
                        action="#{NewExp_Controller.unsubmitAndEdit}"/>
                    </h:panelGroup>
					<h:panelGroup rendered="#{NewExp_Controller.experimentExecutable.executionRunning}" >
						<p>
							Your experiment is currently being executed. Depending on the intensity of your experiment this may take some time.
							<br/>
							<h:commandButton value="Refresh"
							action="goToStage5" />
						</p>
				   </h:panelGroup>
	</h:panelGroup>
	<h:panelGroup rendered="#{((not NewExp_Controller.experimentExecutable.executionRunning) and (NewExp_Controller.experimentExecutable.executionCompleted))}">
				<p>Experiment execution took place with the following details:</p>
				<div class="box">
    			<!--  display some statistics -->
				<h3 class="box">#{res['exp_stage5.statistics']}</h3>
				<p class="box">
					<b>#{res['exp_stage5.started']} </b>#{NewExp_Controller.experimentExecutable.executionStartDate.time}<br />
					<b>#{res['exp_stage5.ended']} </b>#{NewExp_Controller.experimentExecutable.executionEndDate.time}<br />
					<b>#{res['exp_stage5.nrOfInput']} </b>#{ExperimentBean.numberOfOutput}<br />
					<b>#{res['exp_stage5.nrOfOutput']} </b>#{ExperimentBean.numberOfInputFiles}<br />
					<b>#{res['exp_stage5.success']} </b>#{NewExp_Controller.experimentExecutable.executionSuccess}<br />
				</p>
				</div>
				<p>
                <h:commandButton value="#{res['button.edit']}"
                action="#{NewExp_Controller.commandResetAfterFailure}" /> <!-- rendered="#{ ! NewExp_Controller.experimentExecutable.executionSuccess}" -->
                <h:commandButton value="#{res['exp_stage5.button.proceed']}"
                action="#{NewExp_Controller.proceedToEvaluation}"/>
				</p>   
	</h:panelGroup>   

    <a4j:poll id="poll" interval="500" enabled="#{NewExp_Controller.experimentExecutable.executionRunning}"
                reRender="runExperimentForm" />
    
</a4j:form>
		<p>&#160;</p>
		<p>&#160;</p>

		<p>&#160;</p>
		<p>&#160;</p>
		<p>&#160;</p>
		<p>&#160;</p>
		<p>&#160;</p>
		<p>&#160;</p>
		<p>&#160;</p>
		<p>&#160;</p>



            
    <ui:include src="/WEB-INF/templates/comment_template.xhtml">
       <ui:param name="ExperimentBean" value="#{ExperimentBean}" />
       <ui:param name="ExperimentPhase" value="5" />
    </ui:include>
    
		</div>
		</div>
		</div>


		<div id="leftcol">

        <!-- Include the standard experiment builder sidebar. -->
        <ui:include src="/WEB-INF/templates/exp_sidebar.xhtml">
           <ui:param name="ExperimentBean" value="#{ExperimentBean}" />
           <ui:param name="ExperimentPhase" value="5" />
        </ui:include>

		</div>

	</ui:define>
	<ui:define name="footer">
		<ui:include src="/WEB-INF/templates/footer.xhtml" />
	</ui:define>
</ui:composition>

</body>
</html>