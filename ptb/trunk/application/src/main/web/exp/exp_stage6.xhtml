<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:t="http://myfaces.apache.org/tomahawk"
    xmlns:c="http://java.sun.com/jstl/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich">
<body>
<f:view>
<ui:composition template="/WEB-INF/templates/main_template.xhtml">
	<ui:define name="title">
        #{res.title} - #{ExperimentBean.ename}: #{res['exp_stage6.pageTitle']}
  </ui:define>

	<ui:define name="header">
		<ui:include src="/WEB-INF/templates/header.xhtml">
			<ui:param name="page" value="new_exp" />
		</ui:include>
	</ui:define>

	<ui:define name="content" rendered="#{ExperimentBean != null}">
		<div id="mainwrapper">
		<div id="maincol">
		<div class="innertubemain">

		<!-- A: If the execution was successfully: display the results -->
		<a4j:form id="form_results" rendered="#{NewExp_Controller.executionSuccess}">
			<p>View the experiment's input and output data, evaluate the
			outcomes of your experiment against the benchmark goals you specified
			during Stage 3 of the experiment and supply a report about your
			experiment. You may save and re-edit your evaluation as often as
			required.</p>
			
			<h2 class="main">#{res['exp_stage6.headingExperimentEvaluation']}</h2>	
                <rich:dataList id="fileBMGoalEvalList" var="data" value="#{ExperimentBean.IOTableDataForGUI}" rowIndexVar="rowi" style="border:none;width:100%;padding:0px;">
                <rich:simpleTogglePanel id="fileBMGoalToggle" switchType="client" opened="#{data['panelOpened']}" label="Experiment Record ##{rowi+1}: #{data['input']}  -  &lt;&lt;#{data['inputName']}&gt;&gt;" style="padding:0px;">               
               		<!-- rich:effect event="onclick" type="BlindDown" params="duration:0.5" /-->
               		<h2 class="main">#{res['exp_stage6.headingExperimentDataRecord']}</h2>
               		<h:panelGrid columns="2" style="border:none;width:100%;">
	               		<rich:panel style="border:none;">
							<f:facet name="header">#{res['exp_stage6.inputFiles']}</f:facet>
				    		<h:outputLink value="Service Input: "/>
					    		<!-- check if input displayed as URI or as String -->
								<h:outputLink value="#{data['input']}" rendered="#{not empty data['inputTypeURI']}" target="_new">
									#{data['inputName']}
							</h:outputLink>
							<h:outputText value="#{data['input']}" rendered="#{data['inputTypeURI']==null}"/>			
	                   </rich:panel>
	                   <rich:panel style="border:none;">
							<f:facet name="header">#{res['exp_stage6.outputFiles']}</f:facet>
							<h:outputLink value="Service Output: "/>
								<!-- check if input displayed as URI or as String -->
								<h:outputLink value="#{data['output']}" rendered="#{not empty data['outputTypeURI']}" target="_new">
									<h:outputText value="#{data['output']}" style="color:green"/>
							</h:outputLink>
							<h:outputText value="#{data['output']}" rendered="#{data['outputTypeURI']==null}" style="color:green"/>
	                   </rich:panel>
                   </h:panelGrid>
      			   <!-- the file benchmark goals for evaluation -->
                   <h:panelGroup>
                   	  <h2 class="main">#{res['exp_stage6.headingFileBG']}</h2>
                      <rich:dataTable id="bmTableFile_#{rowi}" var="fileBMG"
							value="#{data['fileBMGoals']}" preserveDataModel="false"
							rowId="#{fileBMG.ID}" rowIndexVar="bmrow" cellpadding="2" cellspacing="0" border="1">
							<t:column>
								<f:facet name="header">#{res['exp_stage6.criteria']}: #{ExperimentBean.BGExperimentText}</f:facet>
			                    #{fileBMG.name}
							</t:column>
							<t:column>
								<f:facet name="header">#{res['exp_stage6.explanation']}</f:facet>
							    #{fileBMG.definition} <br />
								<i>#{fileBMG.description}</i>
							</t:column>
							<t:column>
								<f:facet name="header">#{res['exp_stage6.sourceValue']}</f:facet>
			                           <a4j:outputPanel ajaxRendered="true">                 
                                       		<h:inputText value="#{fileBMG.sourceValue}" valueChangeListener="#{ExperimentBean.processFileBMGoalSrcValueChange}" disabled="#{ExperimentBean.finished}" style="border-style: solid; border-color: red;" rendered="#{fileBMG.srcError}">
                                           		<f:param value="#{data['input']}" name="forInputFile"/>
                            					<f:param value="#{fileBMG.ID}" name="forBMgoalID"/>
                       							<a4j:support event="onchange" eventsQueue="foo" reRender="fileBMGoalEvalList"/>
                                        	</h:inputText>
                                       		<h:inputText value="#{fileBMG.sourceValue}" valueChangeListener="#{ExperimentBean.processFileBMGoalSrcValueChange}" disabled="#{ExperimentBean.finished}" rendered="#{not fileBMG.srcError}">
                                           		<f:param value="#{data['input']}" name="forInputFile"/>
                            					<f:param value="#{fileBMG.ID}" name="forBMgoalID"/>
                       							<a4j:support event="onchange" eventsQueue="foo" reRender="fileBMGoalEvalList"/>
                                        	</h:inputText><br/>  
                                        	<h:outputText value="#{fileBMG.typename}" rendered="#{fileBMG.srcError}" style="font-style:italic; color:red;"/>
                                        	<h:outputText value="#{fileBMG.typename}" rendered="#{not fileBMG.srcError}"/>
                                        </a4j:outputPanel>
							</t:column>
							<t:column>
								<f:facet name="header">#{res['exp_stage6.targetValue']}</f:facet>
					                    <a4j:outputPanel ajaxRendered="true">                 
                                       		<h:inputText value="#{fileBMG.targetValue}" valueChangeListener="#{ExperimentBean.processFileBMGoalTargetValueChange}" disabled="#{ExperimentBean.finished}" style="border-style: solid; border-color: red;" rendered="#{fileBMG.tarError}">
                                           		<f:param value="#{data['input']}" name="forInputFile"/>
                            					<f:param value="#{fileBMG.ID}" name="forBMgoalID"/>
                       							<a4j:support event="onchange" eventsQueue="foo" reRender="fileBMGoalEvalList"/>
                                        	</h:inputText>
                                        	<h:inputText value="#{fileBMG.targetValue}" valueChangeListener="#{ExperimentBean.processFileBMGoalTargetValueChange}" disabled="#{ExperimentBean.finished}" rendered="#{not fileBMG.tarError}">
                                           		<f:param value="#{data['input']}" name="forInputFile"/>
                            					<f:param value="#{fileBMG.ID}" name="forBMgoalID"/>
                       							<a4j:support event="onchange" eventsQueue="foo" reRender="fileBMGoalEvalList"/>
                                       		</h:inputText><br/>  
                                        	<h:outputText value="#{fileBMG.typename}" rendered="#{fileBMG.tarError}" style="font-style:italic; color:red;"/>
                                        	<h:outputText value="#{fileBMG.typename}" rendered="#{not fileBMG.tarError}"/>
                                        </a4j:outputPanel>
							</t:column>
							<t:column>
								<f:facet name="header">#{res['exp_stage6.evaluation']}</f:facet>
								<h:selectOneMenu id="fileEvalBmGoal_#{fileBMG.ID}" value="#{fileBMG.evaluationValue}" valueChangeListener="#{ExperimentBean.processFileBMGoalEvalValueChange}" disabled="#{ExperimentBean.finished}">
									<f:selectItems value="#{NewExp_Controller.availableEvaluationValues}" />
									<f:param value="#{data['input']}" name="forInputFile"/>
                                	<f:param value="#{fileBMG.ID}" name="forBMgoalID"/>
                                	<a4j:support event="onchange" eventsQueue="foo"/>
								</h:selectOneMenu>
							</t:column>
						</rich:dataTable>
						<h:messages errorClass="errorMessage" infoClass="infoMessage"/>
                   </h:panelGroup>
                <div class="clear"></div>
                </rich:simpleTogglePanel>
           </rich:dataList> 

			<h2 class="main">#{res['exp_stage6.headingBG']}</h2>
			<p>Below are the benchmark goals you specified during stage three
			of the experiment design. Evaluate the success of your experiment by
			selecting the level of success of each goal.</p>

			<t:dataTable id="bmTable" var="bm"
				value="#{ExperimentBean.experimentBenchmarkBeans}" preserveDataModel="false"
				rowId="#{bm.ID}" cellpadding="2" cellspacing="0" border="1">
				<t:column>
					<f:facet name="header">#{res['exp_stage6.criteria']}: #{ExperimentBean.BGExperimentText}</f:facet>
                    #{bm.name}
				</t:column>
				<t:column>
					<f:facet name="header">#{res['exp_stage6.explanation']}</f:facet>
				    #{bm.definition} <br />
					<i>#{bm.description}</i>
				</t:column>
				<t:column>
					<f:facet name="header">#{res['exp_stage6.sourceValue']}</f:facet>
                                            <h:inputText value="#{bm.sourceValue}" disabled="#{ExperimentBean.finished}"/> <br/>     
                                            	<h:outputText value="#{bm.typename}" />  
				</t:column>
				<t:column>
					<f:facet name="header">#{res['exp_stage6.targetValue']}</f:facet>
                                            <h:inputText value="#{bm.targetValue}"  disabled="#{ExperimentBean.finished}"/><br/>          
                                            <h:outputText value="#{bm.typename}" /> 
				</t:column>
				<t:column>
					<f:facet name="header">#{res['exp_stage6.evaluation']}</f:facet>
					<h:selectOneMenu value="#{bm.evaluationValue}" disabled="#{ExperimentBean.finished}">
						<f:selectItems value="#{NewExp_Controller.availableEvaluationValues}" />
					</h:selectOneMenu>
				</t:column>
				
			</t:dataTable>
			<h:messages errorClass="errorMessage" infoClass="infoMessage"/>
			
           <h2 class="main">#{res['exp_stage6.report']}</h2>
           <p>
               <h:outputLabel value="#{res['exp_stage6.reportTitle']}" for="repTitle" ></h:outputLabel>
               <h:inputText required="false" id="repTitle" value="#{ExperimentBean.reportHeader}" size="82" readonly="#{ExperimentBean.finished}" disabled="#{ExperimentBean.finished}" />
               <h:message for="repTitle" errorClass="errorMessage" infoClass="infoMessage"/>
           </p>
           <p>
               <h:outputLabel value="#{res['exp_stage6.reportBody']}" for="repBody" ></h:outputLabel>
               <h:inputTextarea rows="10" cols="80" required="false" id="repBody" value="#{ExperimentBean.reportBody}" readonly="#{ExperimentBean.finished}" disabled="#{ExperimentBean.finished}" />
               <h:message for="repBody" errorClass="errorMessage" infoClass="infoMessage"/>
           </p>

            <p><h:commandButton id="updateEval" value="#{res['exp_stage6.button']}" action="#{NewExp_Controller.updateEvaluationAction}">
            	 <rich:componentControl for="modelpanel" attachTo="updateEval" operation="show" event="onclick" disableDefault="true"/>
            </h:commandButton></p> 
                
            <p><h:commandButton value="#{res['exp_stage6.finalize']}"
                action="#{NewExp_Controller.finalizeEvaluationAction}" /></p>
                
                
       <!-- testing modal panel>
		<p><a4j:commandButton value="Testing model Panel1" action="#{NewExp_Controller.updateEvaluationAction}"
				oncomplete="if (document.getElementById('hasMessages').value=='true') Richfaces.showModalPanel('modelpanel');"/>
       </p>    
       
       <p><a4j:commandButton value="Testing model Panel2" action="#{NewExp_Controller.updateEvaluationAction}"
				oncomplete="Richfaces.showModalPanel('modelpanel');"/>
       </p>  
		
		<a4j:outputPanel ajaxRendered="true">
				<h:inputHidden id="hasMessages" value="#{ExperimentBean.hasMessages}" />
		</a4j:outputPanel>
			
			    <rich:modalPanel id="modelpanel" width="350" height="100">
			        <f:facet name="header">
			            <h:panelGroup>
			                <h:outputText value="Modal Panel"></h:outputText>
			            </h:panelGroup>
			        </f:facet>
			        <f:facet name="controls">
			            <h:panelGroup>
			             	<img id="hideOverlay" src="${facesContext.externalContext.requestContextPath}/graphics/close.png" alt="close" title="close"/>
			                <rich:componentControl for="modelpanel" attachTo="hideOverlay" operation="hide" event="onclick"/>
			            </h:panelGroup>
			        </f:facet>
			        <h:outputText value="This panel is called using Component Control Component"></h:outputText>
			        <h:outputText value="#{ExperimentBean.popupMessage}"/>
			        <br/>
			        <h:outputText value="Closure link (X) works also through Component Control"></h:outputText>
			    </rich:modalPanel>
			    
		<end testing modal panel -->    
                
                
		</a4j:form>
		
		
		<!-- A: If the execution was NOT successfully: display an error page -->
        <h:form rendered="#{NewExp_Controller.executionSuccess==false}">
        	<h2 class="main">Error Page</h2>
			<p>Experiment Execution failed due to malfunctioning of the underlying service!
			   <h:commandLink immediate="true" value=" Click here " action="#{ExperimentBean.setViewXMLRespondsTrue}"/>to view more details
        	   <h:commandLink immediate="true" value=" or here to hide details. " action="#{ExperimentBean.setViewXMLRespondsFalse}" rendered="#{ExperimentBean.viewXMLResponds}"/></p>
        	<p>
               <h:outputLabel value="service responds: " rendered="#{ExperimentBean.viewXMLResponds}"/>
               <h:inputTextarea rows="10" cols="80" value="#{ExperimentBean.serviceXMLResponds}" readonly="true" rendered="#{ExperimentBean.viewXMLResponds}"/>
            </p>
        </h:form>    
        
    <ui:include src="/WEB-INF/templates/comment_template.xhtml">
       <ui:param name="ExperimentBean" value="#{ExperimentBean}" />
       <ui:param name="ExperimentPhase" value="6" />
    </ui:include>
            
		</div>
		</div>
		</div>
		<div id="leftcol">

		<h3 class="leftcol">Experiment Progress</h3>
		<div class="innertube">
		<ul class="exp">
			<h:form>
				<h:panelGroup rendered="#{ExperimentBean.currentStage > 1}">
					<li class="exp"><h:commandLink action="goToStage1"
								styleClass="exp_done">
							<t:outputText value="#{res['new_exp.stage1']}" />
					</h:commandLink></li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage lt 1}">
					<li class="exp_nd">#{res['new_exp.stage1']}</li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage == 1}">
					<li class="exp_sel"><h:commandLink action="goToStage1" styleClass="exp">
					<t:outputText value="#{res['new_exp.stage1']}" />
					</h:commandLink></li>
				</h:panelGroup>
				
				<h:panelGroup rendered="#{ExperimentBean.currentStage > 2}">
					<li class="exp"><h:commandLink action="goToStage2"
								styleClass="exp_done">
							<t:outputText value="#{res['new_exp.stage2']}" />
					</h:commandLink></li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage lt 2}">
					<li class="exp_nd">#{res['new_exp.stage2']}</li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage == 2}">
					<li class="exp_sel"><h:commandLink action="goToStage2" styleClass="exp">
					<t:outputText value="#{res['new_exp.stage2']}" />
					</h:commandLink></li>
				</h:panelGroup>
				
				<h:panelGroup rendered="#{ExperimentBean.currentStage > 3}">
					<li class="exp"><h:commandLink action="goToStage3"
								styleClass="exp_done">
							<t:outputText value="#{res['new_exp.stage3']}" />
					</h:commandLink></li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage lt 3}">
					<li class="exp_nd">#{res['new_exp.stage3']}</li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage ==3}">
					<li class="exp_sel"><h:commandLink action="goToStage3" styleClass="exp">
					<t:outputText value="#{res['new_exp.stage3']}" />
					</h:commandLink></li>
				</h:panelGroup>
				
				<h:panelGroup rendered="#{ExperimentBean.currentStage > 4}">
					<li class="exp"><h:commandLink action="goToStage4"
								styleClass="exp_done">
							<t:outputText value="#{res['new_exp.stage4']}" />
					</h:commandLink></li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage lt 4}">
					<li class="exp_nd">#{res['new_exp.stage4']}</li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage == 4}">
					<li class="exp_sel"><h:commandLink action="goToStage4" styleClass="exp">
					<t:outputText value="#{res['new_exp.stage4']}" />
					</h:commandLink></li>
				</h:panelGroup>
				
				<h:panelGroup rendered="#{ExperimentBean.currentStage > 5}">
					<li class="exp"><h:commandLink action="goToStage5"
								styleClass="exp_done">
							<t:outputText value="#{res['new_exp.stage5']}" />
					</h:commandLink></li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage lt 5}">
					<li class="exp_nd">#{res['new_exp.stage5']}</li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage == 5}">
					<li class="exp_sel"><h:commandLink action="goToStage5" styleClass="exp">
					<t:outputText value="#{res['new_exp.stage5']}" />
					</h:commandLink></li>
				</h:panelGroup>
				
				<h:panelGroup rendered="#{ExperimentBean.currentStage > 6}">
					<li class="exp"><h:commandLink action="goToStage6"
								styleClass="exp_done">
							<t:outputText value="#{res['new_exp.stage6']}" />
					</h:commandLink></li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage lt 6}">
					<li class="exp_nd">#{res['new_exp.stage6']}</li>
				</h:panelGroup>
				<h:panelGroup rendered="#{ExperimentBean.currentStage == 6}">
					<li class="exp_sel"><h:commandLink action="goToStage6" styleClass="exp">
					<t:outputText value="#{res['new_exp.stage6']}" />
					</h:commandLink></li>
				</h:panelGroup>
			</h:form>
		</ul>
		</div>
		</div>

	</ui:define>
	<ui:define name="footer">
		<ui:include src="/WEB-INF/templates/footer.xhtml" />
	</ui:define>
</ui:composition>
</f:view>

</body>
</html>
