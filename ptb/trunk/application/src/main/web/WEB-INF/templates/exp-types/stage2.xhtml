<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:c="http://java.sun.com/jstl/core"
    xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:t="http://myfaces.apache.org/tomahawk"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich">
<body>
  <ui:composition rendered="#{ExperimentBean != null}">


<h:panelGroup rendered="#{ ! ReadOnly}">
  <p>At this stage you can specify the design your experiment.  This involves selecting an <b>experiment type</b> and one or more <b>preservation services</b> in the left-hand section of the page, and selecting the <b>digital objects</b> you wish to pass through your chosen services in the right-hand section of the page.</p>
  
  <fieldset>
    <legend>#{res['new_exp.expEtype']}</legend>
    <h:outputLabel value="#{res['new_exp.expEtype']}" for="etype" ><span style="color:red;font-weight:bold;"> *</span></h:outputLabel>
        <h:selectOneMenu id="etype" onchange="submit();" required="false"
        value="#{ExperimentBean.etype}"  style="width: 23em;"
 readonly="#{ReadOnly}" disabled="#{ReadOnly}">
                <f:selectItem itemValue="" itemLabel="Select..."/>
                <f:selectItems value="#{NewExp_Controller.availableExperimentTypes}" />
        </h:selectOneMenu>
        
    
	<!--  
    <h:commandButton value="#{res['button.select']}"
             action="success"
             disabled="#{ReadOnly}" rendered="#{ExperimentBean.etype == ''}"/>
	
    <h:commandButton value="#{res['button.change']}"
             action="success"
             disabled="#{ReadOnly}" rendered="#{ExperimentBean.etype != ''}"/>
	-->
   &nbsp;&nbsp;
   <ui:include src="/WEB-INF/templates/fragments/tooltip-icon.xhtml">
     <ui:param name="toolTip" value="#{res['new_exp.tooltipExperimentType']}" />
   </ui:include>
   
  </fieldset>
   
  <h:message for="etype" errorClass="errorMessage" infoClass="infoMessage" showDetail="true" showSummary="true"/>

  <div class="clear"></div>

</h:panelGroup>

<h:panelGroup rendered="#{ExperimentBean.etype == '' and ! ReadOnly}">
<!--  No experiment type yet selected. -->
</h:panelGroup>


    <ui:include src="/WEB-INF/templates/exp-types/stage2_workflow.xhtml">
       <ui:param name="ExperimentBean" value="#{ExperimentBean}" />
    </ui:include>

<!-- Digital Object selection part... -->

        <fieldset>
                
            <legend><h:outputText value="#{res['exp_stage2.inputData']} "/></legend>
                    <p>The list of Digital Object to experiment upon.</p>
                    <h:message for="addedFileInfoPanel" errorClass="errorMessage" infoClass="infoMessage" showDetail="true" showSummary="true"/>
                    
                    <h:panelGroup id="addedFileInfoPanel">
                           <t:dataList var="filemap" value="#{ExperimentBean.experimentInputDataNamesAndURIs}" 
                                         layout="unorderedList" rowIndexVar="rowi">
                                 <h:commandLink title="Remove this Digital Object." rendered="#{! ReadOnly}">
                                   <f:actionListener type="eu.planets_project.tb.gui.backing.exp.RemoveDigitalObjectActionListener"/>
                                   <t:graphicImage value="/graphics/user_trash.png" alt="Delete"/>
                                 </h:commandLink>
                                 <a href="#{filemap['uri']}">#{filemap['name']}</a>
                           </t:dataList>
                    </h:panelGroup>
					<h:panelGroup rendered="#{!ReadOnly}">
					<h4>#{res['exp_stage2.addDOs']}</h4>
                    <p>Use the buttons below to add more Digital Objects to this experiment.  You can select data from the data registry (including data you've uploaded using your FTP account),  or you can upload files to this experiment one at a time using the 'Upload Data' option.</p>
                    </h:panelGroup>


                <h:panelGroup rendered="#{!ReadOnly}">
                <fieldset>
                        <legend>#{res['browse_data.selectData']}</legend>
                                     
                         <p class="center">
                          <h:commandButton value="#{res['browse_data.selectData']}"
                           action="browseForData"
                           disabled="#{ReadOnly}"
                           readonly="#{ReadOnly}"/>
                         </p>
				</fieldset>
                <fieldset>
                        <legend>#{res['exp_stage3.uploadFile']}</legend>
                        
                    <h:panelGroup rendered="#{!richFileUploadBean.richUploadEnabled}">
                         <p class="center">        
                            <t:inputFileUpload id="fileupload"
                                  value="#{FileUploadBean.upFile}"
                                  storage="file"
                                  styleClass="fileUploadInput"
                                  required="false"
                                  maxlength="10000000"  
                                  readonly="#{ReadOnly}" 
                                  disabled="#{ReadOnly}"/>
                                  
                            <h:commandLink id="link_addFileInputItem" 
                                action="#{NewExp_Controller.commandAddInputDataItem}" 
                                disabled="#{ReadOnly}"
                                readonly="#{ReadOnly}">
                                <t:graphicImage value="/graphics/list-add.png" alt="Add" title="Add"/> #{res['button.add']}
                            </h:commandLink>
                            <h:message for="fileupload" rendered="#{ExperimentBean.numberOfInputFiles gt 0}"/>                            
                        </p>
                        
        <p style="text-align: center;">
                            <h:commandLink 
                                action="#{richFileUploadBean.enableRichUpload}">
                                Click here to use the advanced multiple-file uploader.
                            </h:commandLink>
        </p>                        
                        
                    </h:panelGroup>
                        
                    <h:panelGroup rendered="#{richFileUploadBean.richUploadEnabled}">
                    
              <rich:fileUpload fileUploadListener="#{richFileUploadBean.listener}" listWidth="100%"
                maxFilesQuantity="#{richFileUploadBean.maxFiles}"
                id="richUpload" immediateUpload="false" noDuplicate="true"
                acceptedTypes="#{richFileUploadBean.fileTypes}" allowFlash="false">
                <a4j:support event="onuploadcomplete" reRender="addedFileInfoPanel" />
            </rich:fileUpload>

        <p style="text-align: center;">
        This multiple file uploader will not work on all browsers. 
        <br/>
        If you are having problems, you should return the the experiment designer page and add files one-by-one using the simple upload option.
        </p>
        <p style="text-align: center;">
                            <h:commandLink 
                                action="#{richFileUploadBean.disableRichUpload}">
                                Click here to use the simple file uploader.
                            </h:commandLink>
        </p>
        

        </h:panelGroup>
  
              </fieldset>

                        
        </h:panelGroup>
 
      </fieldset>

            
  </ui:composition>
</body>
</html>