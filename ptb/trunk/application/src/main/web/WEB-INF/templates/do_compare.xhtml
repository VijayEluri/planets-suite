<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:c="http://java.sun.com/jsp/jstl/core" 
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:t="http://myfaces.apache.org/tomahawk"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich">
<body>
  <ui:composition rendered="#{dob != null}">

  <a4j:form id="dobCompareForm">
    <!-- Persist the experiment ID through POST, if any. -->    
    <input type="hidden" name="eid" value="#{ExperimentInspector.experimentId}" />
    <!-- Persist the dob ID through POST, if any. -->    
    <input type="hidden" name="dobUri1" value="#{DobCompare.dobUri1}"/>
    <input type="hidden" name="dobUri2" value="#{DobCompare.dobUri2}"/>
  
        <div id="mainwrapper">
        <div id="maincol">
        <div class="innertubemain">
        
        <h2 class="main">Compare Digital Objects</h2>

  
  <div id="digitalObjectRegistryBrowser">
  <h:panelGrid columns="2" columnClasses="halfContent">
    <rich:panel id="dobSummary1">
      <f:facet name="header">
            <h:outputText value="First Object: #{DobCompare.dob1.leafname}"/>
      </f:facet>

         <ui:include src="/WEB-INF/templates/do_summary.xhtml">
           <ui:param name="dob" value="#{DobCompare.dob1}"/>
         </ui:include>
    
    
    </rich:panel>
    
    <rich:panel id="dobSummary2">
      <f:facet name="header">
            <h:outputText value="Second Object: #{DobCompare.dob2.leafname}"/>
      </f:facet>

         <ui:include src="/WEB-INF/templates/do_summary.xhtml">
           <ui:param name="dob" value="#{DobCompare.dob2}"/>
         </ui:include>
    
    </rich:panel>
    
    </h:panelGrid>
    
    <!-- ********************************************************************** -->
    <br/>
    
      <rich:dataTable id="dobCompareMeasurements" 
          onRowMouseOver="this.style.backgroundColor='#{me.odd ? '#eef' : '#eee'}'"
          onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'"
          value="#{DobCompare.measurementComparisons}" var="m" styleClass="tbTable" 
          rows="#{isInExperiment ? '25' : '0'}" reRender="measurements_ds">
          
        <rich:column sortBy="#{m.property.name}">
            <f:facet name="header">
               <h:outputText value="Property"/>
            </f:facet>
            <ui:include src="/WEB-INF/templates/fragments/property_def.xhtml">
              <ui:param name="p" value="#{m.property}"/>
            </ui:include>
        </rich:column>
        
        <rich:column sortBy="#{m.event.agent.name}" sortOrder="DESCENDING">
            <f:facet name="header">
              <h:outputText value="Agent"/>
            </f:facet>

               <h:outputText value="#{m.event.agent.name}"/>
        </rich:column>
        
        <rich:column sortBy="#{m.event.date.time}" sortOrder="DESCENDING">
            <f:facet name="header">
              <h:outputText value="Date"/>
            </f:facet>

            <h:outputText value="#{m.event.shortDate} " rendered="#{m.event.date != null}"/>
            
            <a4j:commandLink action="#{m.event.deleteMeasurementEvent}" reRender="dobCompareMeasurements" rendered="#{!ReadOnly}">
                <t:graphicImage value="/graphics/user_trash.png" alt="Delete Measurement Event"/>
            </a4j:commandLink>
            
        </rich:column>
        
        <rich:column>
            <f:facet name="header">
              <h:outputText value="In First Object"/>
            </f:facet>
            <h:outputText value="#{m.firstValue}" rendered="#{!m.formatProperty}"/>
            <ui:include src="/WEB-INF/templates/fragments/format_bean.xhtml" rendered="#{m.formatProperty}">
              <ui:param name="f" value="#{m.firstFormat}"/>
            </ui:include>
        </rich:column>
        
        <rich:column>
            <f:facet name="header">
              <h:outputText value="In Second Object"/>
            </f:facet>
            <h:outputText value="#{m.secondValue}" rendered="#{!m.formatProperty}"/>
            <ui:include src="/WEB-INF/templates/fragments/format_bean.xhtml" rendered="#{m.formatProperty}">
              <ui:param name="f" value="#{m.secondFormat}"/>
            </ui:include>
        </rich:column>
        
        <rich:column>
            <f:facet name="header">
              <h:outputText value="Comparison"/>
            </f:facet>
            <h:outputText value="#{m.comparison}" styleClass="#{m.equal ? 'equalValue' : 'differentValue'}"/>
        </rich:column>
        
        <rich:column>
            <f:facet name="header">
              <h:outputText value="Equivalence"/>
            </f:facet>
            <h:selectOneMenu value="#{m.userEquivalence}" styleClass="equiv-#{m.userEquivalence}" disabled="#{ReadOnly}">
              <f:selectItem itemValue="" itemLabel="" />
              <f:selectItems value="#{DobCompare.equivalenceOptions}" />
              <a4j:support event="onchange" reRender="dobCompareMeasurements" />
            </h:selectOneMenu>
        </rich:column>
        
        
        <f:facet name="footer">
            <rich:datascroller id="measurements_ds" renderIfSinglePage="false"></rich:datascroller>
        </f:facet>

      </rich:dataTable>
      
    <br/>
    
    <!-- ********************************************************************** -->
    
    <rich:panel id="dobCompareDirect">
      <f:facet name="header">
            <h:outputText value="Compare using Planets services..."/>
      </f:facet>
      
      <dt><b>Compare</b></dt>
      <dd>
        <h:selectOneMenu value="#{DobCompare.compareService}" disabled="#{ReadOnly}">
          <f:selectItem itemValue="" itemLabel="[none]" />
          <f:selectItems value="#{DobCompare.compareServiceList}" />
                    
        </h:selectOneMenu>
        <a4j:commandButton action="#{DobCompare.runCompareService}" reRender="dobCompareDirect" value="Run" disabled="#{ReadOnly}"/>
      </dd>
      <dt>Compare Service Report:</dt>
      <dd>
        <h:outputText value="#{DobCompare.compareServiceReport}"/>
        <h:outputText value="[none]" rendered="#{DobCompare.compareServiceReport == null}"/>
      </dd>
      <dd>
         <ui:include src="/WEB-INF/templates/fragments/show_error_modal.xhtml">
           <ui:param name="message" value="#{DobCompare.compareServiceException}"/>
           <ui:param name="exception" value="#{DobCompare.compareServiceStackTrace}"/>
           <ui:param name="uid" value="1"/>
         </ui:include>
      </dd>
            
    </rich:panel>
    
    <!-- ********************************************************************** -->
    
    <rich:panel id="dobManualCompare">
      <f:facet name="header">
            <h:outputText value="Compare manually..."/>
      </f:facet>
      
  <!-- Manual evaluation: -->
  <!-- 
  <ui:include src="/WEB-INF/templates/exp_stage5_manual_properties.xhtml"/>
   -->
    <h:panelGroup>
    
    
    <fieldset>
    <legend>Add a property measurement</legend>
    <p><h:outputLabel value="Property" for="newProperty" id="manualproperties"/>
        <h:selectOneMenu id="newProperty" value="#{DobCompare.newManProp}">
            <f:selectItem itemValue="" itemLabel="Please select a property, or add a new one..." />
            <f:selectItems value="#{DobCompare.allManualMeasurementProperties}" />
            <a4j:support event="onchange" reRender="dobManualCompare"/>
        </h:selectOneMenu>
    </p>

        <rich:simpleTogglePanel id="addPropToggle" switchType="client" opened="false" label="Manage user properties...">
        <fieldset>
        <p><h:outputLabel value="Name" for="newPropName"/>
          <h:inputText size="80" id="newPropName" value="#{DobCompare.addManPropName}"/>
        </p>
        <p><h:outputLabel value="Description" for="newPropDesc"/>
          <h:inputTextarea rows="5" cols="78" id="newPropDesc" value="#{DobCompare.addManPropDesc}"/>
        </p>
        
        <a4j:commandButton action="#{DobCompare.createNewManualMeasurementProperty}" reRender="dobManualCompare" value="Add"/>
        <a4j:commandButton action="#{DobCompare.removeManualMeasurementProperty}" reRender="dobManualCompare" value="Remove"/>
        </fieldset>
        </rich:simpleTogglePanel>
    
    <br/>    
    
    <h:panelGrid columns="2" style="width:120px;" rendered="#{!ReadOnly}">
    	<h:outputLabel value="Value in #{DobCompare.dob1.leafname}" for="newValueOne" styleClass="auto"/>
    	<h:outputLabel value="Value in #{DobCompare.dob2.leafname}" for="newValueTwo" styleClass="auto"/>
    	
        <h:inputText id="newValueOne" value="#{DobCompare.newManVal1}"/>
        <h:inputText id="newValueTwo" value="#{DobCompare.newManVal2}"/>
    </h:panelGrid>
    
<!-- Lets stick to simple property extraction for now. Comparative properties are hard.
    <p><h:outputLabel value="Comparative Value" for="newValueCmp" styleClass="auto"/>
          <h:inputText id="newValueCmp" value="# {DobCompare.newManCmp}"/>
    </p>
 -->
    
        <a4j:commandButton action="#{DobCompare.storeManualMeasurement}" reRender="dobCompareMeasurements" value="Store" disabled="#{ReadOnly}"/>
        
    </fieldset>
    <fieldset>
    <legend> <h:outputText value="#{res['exp_stage5.environment']} "/></legend>
        <p>If you manually measure any properties it is important that you document 
        the environment where these measurements were made.  Values recorded may vary 
        considerably depending on the renderer, codecs, software, operating system and 
        hardware environment.  Ideally you should record such information for every piece 
        of software you use to measure a property in the box below.</p>
               
        <p>
        <h:inputTextarea rows="5" cols="80" required="false" id="envReport" value="#{DobCompare.manualMeasurementEnvironment}" disabled="#{ReadOnly}"/>
        </p>
        
        <a4j:commandButton action="#{DobCompare.updateManualMeasurment}" reRender="dobManualCompare" value="Store" disabled="#{ReadOnly}"/>
        
     </fieldset>
 	</h:panelGroup>
      
      
  </rich:panel>
    
        <!-- ********************************************************************** -->
    
    
    </div>
    
        
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
    
        </div>
        </div>
        </div>
        
        
 </a4j:form>  
    
  </ui:composition>
</body>
</html>
    
