<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:c="http://java.sun.com/jsp/jstl/core" 
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:t="http://myfaces.apache.org/tomahawk"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich">
<body>
  <ui:composition rendered="#{dob != null}">

  <a4j:form id="dobCompareForm">
    <!-- Persist the experiment ID through POST, if any. -->    
    <input type="hidden" name="eid" value="#{ExperimentInspector.experimentId}" />
    <!-- Persist the dob ID through POST, if any. -->    
    <input type="hidden" name="dobUri1" value="#{DobCompare.dobUri1}"/>
    <input type="hidden" name="dobUri2" value="#{DobCompare.dobUri2}"/>
  
        <div id="mainwrapper">
        <div id="maincol">
        <div class="innertubemain">
        
        <h2 class="main">Compare Digital Objects</h2>

  
  <div id="digitalObjectRegistryBrowser">
  <h:panelGrid columns="2" columnClasses="halfContent">
    <rich:panel id="dobSummary1">
      <f:facet name="header">
            <h:outputText value="#{DobCompare.dob1.leafname}"/>
      </f:facet>

         <ui:include src="/WEB-INF/templates/do_summary.xhtml">
           <ui:param name="dob" value="#{DobCompare.dob1}"/>
         </ui:include>
    
    
    </rich:panel>
    
    <rich:panel id="dobSummary2">
      <f:facet name="header">
            <h:outputText value="#{DobCompare.dob2.leafname}"/>
      </f:facet>

         <ui:include src="/WEB-INF/templates/do_summary.xhtml">
           <ui:param name="dob" value="#{DobCompare.dob2}"/>
         </ui:include>
  
    
    </rich:panel>
    
    </h:panelGrid>
    
    <!-- ********************************************************************** -->
    
    <rich:panel id="dobCompareDirect">
      <f:facet name="header">
            <h:outputText value="Compare using Planets services..."/>
      </f:facet>
      
      <dt><b>Compare</b></dt>
      <dd>
        <h:selectOneMenu value="#{DobCompare.compareService}">
          <f:selectItem itemValue="" itemLabel="[none]" />
          <f:selectItems value="#{DobCompare.compareServiceList}" />
                    
        </h:selectOneMenu>
        <a4j:commandButton action="#{DobCompare.runCompareService}" reRender="dobCompareDirect" value="Run" disabled="#{ReadOnly}"/>
      </dd>
      <dt>Compare Service Report:</dt>
      <dd>
        <h:outputText value="#{DobCompare.compareServiceReport}"/>
        <h:outputText value="[none]" rendered="#{DobCompare.compareServiceReport == null}"/>
      </dd>
      <dd>
         <ui:include src="/WEB-INF/templates/fragments/show_error_modal.xhtml">
           <ui:param name="message" value="#{DobCompare.compareServiceException}"/>
           <ui:param name="exception" value="#{DobCompare.compareServiceStackTrace}"/>
           <ui:param name="uid" value="1"/>
         </ui:include>
      </dd>
      
      <dt>Measurements:</dt>
          
    <!-- ********************************************************************** -->
    
      <rich:dataTable id="dobCompareMeasurements" 
          onRowMouseOver="this.style.backgroundColor='#{me.odd ? '#eef' : '#eee'}'"
          onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'"
          value="#{DobCompare.experimentMeasurements}" var="me" styleClass="tbTable" 
          rows="#{isInExperiment ? '25' : '0'}" reRender="measurements_ds">
          
          <f:facet name="header">
           <rich:columnGroup>
            <rich:column>
              <h:outputText value="Property"/>
            </rich:column>
            <rich:column>
              <h:outputText value="In #{DobCompare.dob1.leafname}"/>
            </rich:column>
            <rich:column>
              <h:outputText value="In #{DobCompare.dob2.leafname}"/>
            </rich:column>
            <rich:column>
              <h:outputText value="Comparison"/>
            </rich:column>
            <rich:column>
              <h:outputText value="Equivalence"/>
            </rich:column>
           </rich:columnGroup>
          </f:facet>
      
        <rich:column colspan="5" styleClass="#{me.odd ? 'oddRow' : 'evenRow'}" sortBy="#{me.event.date}" sortOrder="DESCENDING">
            <f:facet name="header">Measurement Date</f:facet>
            
            <h:outputText value="#{me.event.agent.name} "/>
            
            <h:outputText value="#{me.event.date.time} " rendered="#{me.event.date != null}">
                <f:convertDateTime type="time" dateStyle="short"/>
            </h:outputText>
            
            <a4j:commandLink action="#{me.event.deleteMeasurementEvent}" reRender="dobCompareMeasurements" rendered="#{isInExperiment}">
                <t:graphicImage value="/graphics/user_trash.png" alt="Delete Measurement Event"/>
            </a4j:commandLink>
            
        </rich:column>
        
        <!-- SubTable starts... -->
        <rich:subTable var="m" value="#{me.comparisons}">
        
        <rich:column styleClass="#{me.odd ? 'oddRow' : 'evenRow'}">
            <ui:include src="/WEB-INF/templates/fragments/property_def.xhtml">
              <ui:param name="p" value="#{m.property}"/>
            </ui:include>
        </rich:column>
        
        <rich:column styleClass="#{me.odd ? 'oddRow' : 'evenRow'}">
            <h:outputText value="#{m.firstValue}" rendered="#{!m.formatProperty}"/>
            <ui:include src="/WEB-INF/templates/fragments/format_bean.xhtml" rendered="#{m.formatProperty}">
              <ui:param name="f" value="#{m.firstFormat}"/>
            </ui:include>
        </rich:column>
        
        <rich:column styleClass="#{me.odd ? 'oddRow' : 'evenRow'}">
            <h:outputText value="#{m.secondValue}" rendered="#{!m.formatProperty}"/>
            <ui:include src="/WEB-INF/templates/fragments/format_bean.xhtml" rendered="#{m.formatProperty}">
              <ui:param name="f" value="#{m.secondFormat}"/>
            </ui:include>
        </rich:column>
        
        <rich:column styleClass="#{me.odd ? 'oddRow' : 'evenRow'}">
            <h:outputText value="#{m.comparison}" styleClass="#{m.equal ? 'equalValue' : 'differentValue'}"/>
        </rich:column>
        
        <rich:column styleClass="#{me.odd ? 'oddRow' : 'evenRow'}">
            <h:selectOneMenu value="#{m.userEquivalence}" styleClass="equiv-#{m.userEquivalence}">
              <f:selectItem itemValue="" itemLabel="" />
              <f:selectItems value="#{DobCompare.equivalenceOptions}" />
              <a4j:support event="onchange" reRender="dobCompareMeasurements" />
            </h:selectOneMenu>
        </rich:column>
        
        </rich:subTable>
        <!-- SubTable ends... -->
        
        
        <f:facet name="footer">
            <rich:datascroller id="measurements_ds" renderIfSinglePage="false"></rich:datascroller>
        </f:facet>

      </rich:dataTable>
      
    </rich:panel>
    
    <rich:panel id="dobManualCompare">
      <f:facet name="header">
            <h:outputText value="Compare manually..."/>
      </f:facet>
      
  <!-- Manual evaluation: -->
  <!-- 
  <ui:include src="/WEB-INF/templates/exp_stage5_manual_properties.xhtml"/>
   -->
    <h:panelGroup rendered="#{!ReadOnly}">
    
    
    <fieldset>
    <legend>Add a property measurement</legend>
    <p><h:outputLabel value="Property" for="newProperty" id="manualproperties"/>
        <h:selectOneMenu id="newProperty" value="#{DobCompare.newManProp}">
            <f:selectItem itemValue="" itemLabel="Please select a property, or add a new one..." />
            <f:selectItems value="#{DobCompare.allManualMeasurementProperties}" />
            <a4j:support event="onchange" reRender="dobManualCompare"/>
        </h:selectOneMenu>
    </p>

        <rich:simpleTogglePanel id="addPropToggle" switchType="client" opened="false" label="Manage user properties...">
        <fieldset>
        <p><h:outputLabel value="Name" for="newPropName"/>
          <h:inputText size="80" id="newPropName" value="#{DobCompare.addManPropName}"/>
        </p>
        <p><h:outputLabel value="Description" for="newPropDesc"/>
          <h:inputTextarea rows="5" cols="78" id="newPropDesc" value="#{DobCompare.addManPropDesc}"/>
        </p>
        
        <a4j:commandButton action="#{DobCompare.createNewManualMeasurementProperty}" reRender="dobManualCompare" value="Add"/>
        <a4j:commandButton action="#{DobCompare.removeManualMeasurementProperty}" reRender="dobManualCompare" value="Remove"/>
        </fieldset>
        </rich:simpleTogglePanel>
    
    <br/>    
    
    <h:panelGrid columns="2" style="width:120px;">
    	<h:outputLabel value="Value in #{DobCompare.dob1.leafname}" for="newValueOne" styleClass="auto"/>
    	<h:outputLabel value="Value in #{DobCompare.dob2.leafname}" for="newValueTwo" styleClass="auto"/>
    	
        <h:inputText id="newValueOne" value="#{DobCompare.newManVal1}"/>
        <h:inputText id="newValueTwo" value="#{DobCompare.newManVal2}"/>
    </h:panelGrid>
    
<!-- Lets stick to simple property extraction for now. Comparative properties are hard.
    <p><h:outputLabel value="Comparative Value" for="newValueCmp" styleClass="auto"/>
          <h:inputText id="newValueCmp" value="# {DobCompare.newManCmp}"/>
    </p>
 -->
    
        <a4j:commandButton action="#{DobCompare.storeManualMeasurement}" reRender="dobCompareMeasurements" value="Store" />
        
    </fieldset>
    <fieldset>
    <legend> <h:outputText value="#{res['exp_stage5.environment']} "/></legend>
        <p>If you manually measure any properties it is important that you document 
        the environment where these measurements were made.  Values recorded may vary 
        considerably depending on the renderer, codecs, software, operating system and 
        hardware environment.  Ideally you should record such information for every piece 
        of software you use to measure a property in the box below.</p>
               
        <p>
        <h:inputTextarea rows="5" cols="80" required="false" id="envReport" value="#{DobCompare.manualMeasurementEnvironment}" />
        </p>
        
        <a4j:commandButton action="#{DobCompare.updateManualMeasurment}" reRender="dobManualCompare" value="Store" />
        
     </fieldset>
 	</h:panelGroup>
      
      
  </rich:panel>
    
        <!-- ********************************************************************** -->
    
    
    </div>
    
        
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
    
        </div>
        </div>
        </div>
        
        
 </a4j:form>  
    
  </ui:composition>
</body>
</html>
    
