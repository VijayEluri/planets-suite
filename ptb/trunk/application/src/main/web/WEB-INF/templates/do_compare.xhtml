<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:c="http://java.sun.com/jsp/jstl/core" 
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:t="http://myfaces.apache.org/tomahawk"
    xmlns:a4j="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich">
<body>
  <ui:composition rendered="#{dob != null}">

  <a4j:form id="dobCompareForm">
    <!-- Persist the experiment ID through POST, if any. -->    
    <input type="hidden" name="eid" value="#{ExperimentInspector.experimentId}" />
    <!-- Persist the dob ID through POST, if any. -->    
    <input type="hidden" name="dobUri1" value="#{DobCompare.dobUri1}"/>
    <input type="hidden" name="dobUri2" value="#{DobCompare.dobUri2}"/>
  
        <div id="mainwrapper">
        <div id="maincol">
        <div class="innertubemain">
        
        <h2 class="main">Compare Digital Objects</h2>

  
  <div id="digitalObjectRegistryBrowser">
  <h:panelGrid columns="2" columnClasses="halfContent">
    <rich:panel id="dobSummary1">
      <f:facet name="header">
            <h:outputText value="#{DobCompare.dob1.leafname}"/>
      </f:facet>

         <ui:include src="/WEB-INF/templates/do_summary.xhtml">
           <ui:param name="dob" value="#{DobCompare.dob1}"/>
         </ui:include>
    
    
    </rich:panel>
    
    <rich:panel id="dobSummary2">
      <f:facet name="header">
            <h:outputText value="#{DobCompare.dob2.leafname}"/>
      </f:facet>

         <ui:include src="/WEB-INF/templates/do_summary.xhtml">
           <ui:param name="dob" value="#{DobCompare.dob2}"/>
         </ui:include>
  
    
    </rich:panel>
    
    </h:panelGrid>
    
    <!-- ********************************************************************** -->
    
    <rich:panel id="dobCompareDirect">
      <f:facet name="header">
            <h:outputText value="Compare using Planets services..."/>
      </f:facet>
      
      <dt><b>Compare</b></dt>
      <dd>
        <h:selectOneMenu value="#{DobCompare.compareService}">
          <f:selectItem itemValue="" itemLabel="[none]" />
          <f:selectItems value="#{DobCompare.compareServiceList}" />
                    
        </h:selectOneMenu>
        <a4j:commandButton action="#{DobCompare.runCompareService}" reRender="dobCompareDirect,dobCompareMeasurements" value="Run"/>
      </dd>
      <dt>Compare Service Report:</dt>
      <dd>
        <h:outputText value="#{DobCompare.compareServiceReport}"/>
        <h:outputText value="[none]" rendered="#{DobCompare.compareServiceReport == null}"/>
      </dd>
      <dd>
         <ui:include src="/WEB-INF/templates/fragments/show_error_modal.xhtml">
           <ui:param name="message" value="#{DobCompare.compareServiceException}"/>
           <ui:param name="exception" value="#{DobCompare.compareServiceStackTrace}"/>
           <ui:param name="uid" value="1"/>
         </ui:include>
      </dd>
      
      <dt>Measurements:</dt>
          
    <!-- ********************************************************************** -->
    
      <rich:dataTable id="dobCompareMeasurements" 
          onRowMouseOver="this.style.backgroundColor='#{me.odd ? '#eef' : '#eee'}'"
          onRowMouseOut="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'"
          value="#{DobCompare.experimentMeasurements}" var="me" styleClass="tbTable" 
          rows="#{isInExperiment ? '25' : '0'}" reRender="measurements_ds">
          
          <f:facet name="header">
           <rich:columnGroup>
            <rich:column>
              <h:outputText value="Property"/>
            </rich:column>
            <rich:column>
              <h:outputText value="In #{DobCompare.dob1.leafname}"/>
            </rich:column>
            <rich:column>
              <h:outputText value="In #{DobCompare.dob2.leafname}"/>
            </rich:column>
            <rich:column>
              <h:outputText value="Comparison"/>
            </rich:column>
            <rich:column>
              <h:outputText value="Equivalence"/>
            </rich:column>
           </rich:columnGroup>
          </f:facet>
      
        <rich:column colspan="5" styleClass="#{me.odd ? 'oddRow' : 'evenRow'}" sortBy="#{me.event.date}" sortOrder="DESCENDING">
            <f:facet name="header">Measurement Date</f:facet>
            
            <h:outputText value="#{me.event.agent.name} "/>
            
            <h:outputText value="#{me.event.date.time} " rendered="#{me.event.date != null}">
                <f:convertDateTime type="time" dateStyle="short"/>
            </h:outputText>
            
            <a4j:commandLink action="#{me.event.deleteMeasurementEvent}" reRender="dobCompareMeasurements" rendered="#{isInExperiment}">
                <t:graphicImage value="/graphics/user_trash.png" alt="Delete Measurement Event"/>
            </a4j:commandLink>
            
        </rich:column>
        
        <!-- SubTable starts... -->
        <rich:subTable var="m" value="#{me.comparisons}">
        
        <rich:column styleClass="#{me.odd ? 'oddRow' : 'evenRow'}">
            <ui:include src="/WEB-INF/templates/fragments/property_def.xhtml">
              <ui:param name="p" value="#{m.property}"/>
            </ui:include>
        </rich:column>
        
        <rich:column styleClass="#{me.odd ? 'oddRow' : 'evenRow'}">
            <h:outputText value="#{m.firstValue}" rendered="#{!m.formatProperty}"/>
            <ui:include src="/WEB-INF/templates/fragments/format_bean.xhtml" rendered="#{m.formatProperty}">
              <ui:param name="f" value="#{m.firstFormat}"/>
            </ui:include>
        </rich:column>
        
        <rich:column styleClass="#{me.odd ? 'oddRow' : 'evenRow'}">
            <h:outputText value="#{m.secondValue}" rendered="#{!m.formatProperty}"/>
            <ui:include src="/WEB-INF/templates/fragments/format_bean.xhtml" rendered="#{m.formatProperty}">
              <ui:param name="f" value="#{m.secondFormat}"/>
            </ui:include>
        </rich:column>
        
        <rich:column styleClass="#{me.odd ? 'oddRow' : 'evenRow'}">
            <h:outputText value="#{m.comparison}" styleClass="#{m.equal ? 'equalValue' : 'differentValue'}"/>
        </rich:column>
        
        <rich:column styleClass="#{me.odd ? 'oddRow' : 'evenRow'}">
            <h:selectOneMenu value="#{m.userEquivalence}" styleClass="equiv-#{m.userEquivalence}">
              <f:selectItem itemValue="" itemLabel="" />
              <f:selectItems value="#{m.equivalenceOptions}" />
              <a4j:support event="onchange" reRender="dobCompareMeasurements" />
            </h:selectOneMenu>
        </rich:column>
        
        </rich:subTable>
        <!-- SubTable ends... -->
        
        
        <f:facet name="footer">
            <rich:datascroller id="measurements_ds" renderIfSinglePage="false"></rich:datascroller>
        </f:facet>

      </rich:dataTable>
      
    </rich:panel>
    
        <!-- ********************************************************************** -->
    
    
    </div>
    
        
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
    
        </div>
        </div>
        </div>
        
        
 </a4j:form>  
    
  </ui:composition>
</body>
</html>
    
